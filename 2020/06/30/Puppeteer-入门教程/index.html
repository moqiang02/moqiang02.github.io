<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Puppeteer 入门教程 | 自强不息</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Puppeteer 简介Puppeteer 是一个node库，他提供了一组用来操纵Chrome的API, 通俗来说就是一个 headless chrome浏览器 (当然你也可以配置成有UI的，默认是没有的)。既然是浏览器，那么我们手工可以在浏览器上做的事情 Puppeteer 都能胜任, 另外，Puppeteer 翻译成中文是”木偶”意思，所以听名字就知道，操纵起来很方便，你可以很方便的操纵她去实">
<meta property="og:type" content="article">
<meta property="og:title" content="Puppeteer 入门教程">
<meta property="og:url" content="http://moqiang02.github.io/2020/06/30/Puppeteer-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/index.html">
<meta property="og:site_name" content="自强不息">
<meta property="og:description" content="Puppeteer 简介Puppeteer 是一个node库，他提供了一组用来操纵Chrome的API, 通俗来说就是一个 headless chrome浏览器 (当然你也可以配置成有UI的，默认是没有的)。既然是浏览器，那么我们手工可以在浏览器上做的事情 Puppeteer 都能胜任, 另外，Puppeteer 翻译成中文是”木偶”意思，所以听名字就知道，操纵起来很方便，你可以很方便的操纵她去实">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-30T13:09:44.000Z">
<meta property="article:modified_time" content="2023-08-18T07:17:13.859Z">
<meta property="article:author" content="moqiang">
<meta property="article:tag" content="爬虫">
<meta property="article:tag" content="Puppeteer">
<meta name="twitter:card" content="summary">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">自强不息</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://moqiang02.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-Puppeteer-入门教程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/06/30/Puppeteer-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2020-06-30T13:09:44.000Z" itemprop="datePublished">2020-06-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nodejs/">nodejs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Puppeteer 入门教程
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      

          <!-- rex -->
          
            <!-- 文章目录开始 -->
            
              <div id="toc" class="toc-article">
              <strong class="toc-title" style="cursor:pointer">目录</strong>
              <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Puppeteer-%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">Puppeteer 简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83"><span class="toc-number">2.</span> <span class="toc-text">运行环境</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="toc-number">3.</span> <span class="toc-text">基本用法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-puppeteer-launch-options"><span class="toc-number">3.1.</span> <span class="toc-text">1 puppeteer.launch(options)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Browser-%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.2.</span> <span class="toc-text">2 Browser 对象</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Puppeteer-%E5%AE%9E%E6%88%98"><span class="toc-number">4.</span> <span class="toc-text">Puppeteer 实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0"><span class="toc-number">4.1.</span> <span class="toc-text">1 获取元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%8E%B7%E5%8F%96%E5%85%83%E7%B4%A0%E5%B1%9E%E6%80%A7"><span class="toc-number">4.2.</span> <span class="toc-text">2 获取元素属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%89%A7%E8%A1%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84-JS-%E8%84%9A%E6%9C%AC"><span class="toc-number">4.3.</span> <span class="toc-text">3 执行自定义的 JS 脚本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Page-exposeFunction"><span class="toc-number">4.4.</span> <span class="toc-text">4 Page.exposeFunction</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Page-emulate-%E4%BF%AE%E6%94%B9%E6%A8%A1%E6%8B%9F%E5%99%A8-%E5%AE%A2%E6%88%B7%E7%AB%AF-%E8%BF%90%E8%A1%8C%E9%85%8D%E7%BD%AE"><span class="toc-number">5.</span> <span class="toc-text">Page.emulate 修改模拟器(客户端)运行配置</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%AE%E7%9B%98%E5%92%8C%E9%BC%A0%E6%A0%87"><span class="toc-number">6.</span> <span class="toc-text">键盘和鼠标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%A6%E5%A4%96%E5%87%A0%E4%B8%AA%E6%9C%89%E7%94%A8%E7%9A%84-API"><span class="toc-number">7.</span> <span class="toc-text">另外几个有用的 API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Page-waitFor-%E7%B3%BB%E5%88%97-API"><span class="toc-number">7.1.</span> <span class="toc-text">1 Page.waitFor 系列 API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-page-getMetrics"><span class="toc-number">7.2.</span> <span class="toc-text">2 page.getMetrics()</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="toc-number">8.</span> <span class="toc-text">调试技巧</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">9.</span> <span class="toc-text">错误处理</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E5%92%8C%E6%BA%90%E7%A0%81"><span class="toc-number">10.</span> <span class="toc-text">总结和源码</span></a></li></ol>
              </div>
            
            <!-- 文章目录结束 -->	  
          

        <h1 id="Puppeteer-简介"><a href="#Puppeteer-简介" class="headerlink" title="Puppeteer 简介"></a>Puppeteer 简介</h1><p>Puppeteer 是一个node库，他提供了一组用来操纵Chrome的API, 通俗来说就是一个 headless chrome浏览器 (当然你也可以配置成有UI的，默认是没有的)。既然是浏览器，那么我们手工可以在浏览器上做的事情 Puppeteer 都能胜任, 另外，Puppeteer 翻译成中文是”木偶”意思，所以听名字就知道，操纵起来很方便，你可以很方便的操纵她去实现：</p>
<blockquote>
<p>1） 生成网页截图或者 PDF<br>2） 高级爬虫，可以爬取大量异步渲染内容的网页<br>3） 模拟键盘输入、表单自动提交、登录网页等，实现 UI 自动化测试<br>4） 捕获站点的时间线，以便追踪你的网站，帮助分析网站性能问题</p>
</blockquote>
<p>如果你用过 PhantomJS 的话，你会发现她们有点类似，但Puppeteer是Chrome官方团队进行维护的，用俗话说就是”有娘家的人“，前景更好。<span id="more"></span></p>
<h1 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h1><p>查看 Puppeteer 的官方 API 你会发现满屏的 async, await 之类，这些都是 ES7 的规范，所以你需要：</p>
<ol>
<li> Nodejs 的版本不能低于 v7.6.0, 需要支持 async, await.</li>
<li> 需要最新的 chrome driver, 这个你在通过 npm 安装 Puppeteer 的时候系统会自动下载的</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install puppeteer --save</span><br></pre></td></tr></table></figure>

<h1 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h1><p>先开看看官方的入门的 DEMO</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>();</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;https://example.com&#x27;</span>);</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;<span class="attr">path</span>: <span class="string">&#x27;example.png&#x27;</span>&#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<p>上面这段代码就实现了网页截图，先大概解读一下上面几行代码：</p>
<ol>
<li> 先通过 puppeteer.launch() 创建一个浏览器实例 Browser 对象</li>
<li> 然后通过 Browser 对象创建页面 Page 对象</li>
<li> 然后 page.goto() 跳转到指定的页面</li>
<li> 调用 page.screenshot() 对页面进行截图</li>
<li> 关闭浏览器</li>
</ol>
<p>是不是觉得好简单？ 反正我是觉得比 PhantomJS 简单，至于跟 selenium-webdriver 比起来， 那更不用说了。下面就介绍一下 puppeteer 的常用的几个 API。</p>
<h2 id="1-puppeteer-launch-options"><a href="#1-puppeteer-launch-options" class="headerlink" title="1 puppeteer.launch(options)"></a>1 puppeteer.launch(options)</h2><p>使用 puppeteer.launch() 运行 puppeteer，它会 return 一个 promise，使用 then 方法获取 browser 实例， 当然高版本的 的 nodejs 已经支持 await 特性了，所以上面的例子使用 await 关键字，这一点需要特殊说明一下，<strong>Puppeteer 几乎所有的操作都是 异步的</strong>, 为了使用大量的 then 使得代码的可读性降低，本文所有 demo 代码都是用 <strong>async, await</strong> 方式实现。这个 也是 Puppeteer 官方推荐的写法。对 async/await 一脸懵逼的同学狠狠的<a target="_blank" rel="noopener" href="http://www.r9it.com/20171108/async-await.html">戳这里</a></p>
<p><strong>options 参数详解</strong></p>
<table>
<thead>
<tr>
<th>参数名称</th>
<th>参数类型</th>
<th>参数说明</th>
</tr>
</thead>
<tbody><tr>
<td>ignoreHTTPSErrors</td>
<td>boolean</td>
<td>在请求的过程中是否忽略 Https 报错信息，默认为 false</td>
</tr>
<tr>
<td>headless</td>
<td>boolean</td>
<td>是否以”无头”的模式运行 chrome, 也就是不显示 UI， 默认为 true</td>
</tr>
<tr>
<td>executablePath</td>
<td>string</td>
<td>可执行文件的路劲，Puppeteer 默认是使用它自带的 chrome webdriver, 如果你想指定一个自己的 webdriver 路径，可以通过这个参数设置</td>
</tr>
<tr>
<td>slowMo</td>
<td>number</td>
<td>使 Puppeteer 操作减速，单位是毫秒。如果你想看看 Puppeteer 的整个工作过程，这个参数将非常有用。</td>
</tr>
<tr>
<td>args</td>
<td>Array(String)</td>
<td>传递给 chrome 实例的其他参数，比如你可以使用”–ash-host-window-bounds=1024x768” 来设置浏览器窗口大小。更多参数参数列表可以参考<a target="_blank" rel="noopener" href="https://peter.sh/experiments/chromium-command-line-switches/">这里</a></td>
</tr>
<tr>
<td>handleSIGINT</td>
<td>boolean</td>
<td>是否允许通过进程信号控制 chrome 进程，也就是说是否可以使用 CTRL+C 关闭并退出浏览器.</td>
</tr>
<tr>
<td>timeout</td>
<td>number</td>
<td>等待 Chrome 实例启动的最长时间。默认为30000（30秒）。如果传入 0 的话则不限制时间</td>
</tr>
<tr>
<td>dumpio</td>
<td>boolean</td>
<td>是否将浏览器进程stdout和stderr导入到process.stdout和process.stderr中。默认为false。</td>
</tr>
<tr>
<td>userDataDir</td>
<td>string</td>
<td>设置用户数据目录，默认linux 是在 <code>~/.config</code> 目录，window 默认在 C:\Users{USER}\AppData\Local\Google\Chrome\User Data</td>
</tr>
<tr>
<td>env</td>
<td>Object</td>
<td>指定对Chromium可见的环境变量。默认为process.env。</td>
</tr>
<tr>
<td>devtools</td>
<td>boolean</td>
<td>是否为每个选项卡自动打开DevTools面板， 这个选项只有当 headless 设置为 false 的时候有效</td>
</tr>
</tbody></table>
<blockquote>
<p>注：Ubuntu系统使用root执行脚本时，可能会报错【Running as root without –no-sandbox is not supported】，先尝试安装依赖<code>sudo apt install gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget</code>，还不行的话，代码改成<code>puppetteer.launch(&#123;args: [&#39;--no-sandbox&#39;]&#125;)</code>，<a target="_blank" rel="noopener" href="https://github.com/puppeteer/puppeteer/issues/3698">issue</a>。</p>
</blockquote>
<blockquote>
<p>注：如果<code>headless:true</code>的情况下，userDataDir使用相对路径的话，会报超时错误，应该使用绝对路径才行。如果是Windows系统，路径示例：<code>c:\\tmp\\dir</code></p>
</blockquote>
<h2 id="2-Browser-对象"><a href="#2-Browser-对象" class="headerlink" title="2 Browser 对象"></a>2 Browser 对象</h2><p>当 Puppeteer 连接到一个 Chrome 实例的时候就会创建一个 Browser 对象，有以下两种方式：</p>
<p>Puppeteer.launch 和 Puppeteer.connect.</p>
<p>下面这个 DEMO 实现断开连接之后重新连接浏览器实例</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"></span><br><span class="line">puppeteer.<span class="title function_">launch</span>().<span class="title function_">then</span>(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line">  <span class="comment">// 保存 Endpoint，这样就可以重新连接  Chromium</span></span><br><span class="line">  <span class="keyword">const</span> browserWSEndpoint = browser.<span class="title function_">wsEndpoint</span>();</span><br><span class="line">  <span class="comment">// 从Chromium 断开连接</span></span><br><span class="line">  browser.<span class="title function_">disconnect</span>();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用endpoint 重新和 Chromiunm 建立连接</span></span><br><span class="line">  <span class="keyword">const</span> browser2 = <span class="keyword">await</span> puppeteer.<span class="title function_">connect</span>(&#123;browserWSEndpoint&#125;);</span><br><span class="line">  <span class="comment">// Close Chromium</span></span><br><span class="line">  <span class="keyword">await</span> browser2.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>Browser 对象 API</strong></p>
<table>
<thead>
<tr>
<th>方法名称</th>
<th>返回值</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>browser.close()</td>
<td>Promise</td>
<td>关闭浏览器</td>
</tr>
<tr>
<td>browser.disconnect()</td>
<td>void</td>
<td>断开浏览器连接</td>
</tr>
<tr>
<td>browser.newPage()</td>
<td>Promise(Page)</td>
<td>创建一个 Page 实例</td>
</tr>
<tr>
<td>browser.pages()</td>
<td>Promise(Array(Page))</td>
<td>获取所有打开的 Page 实例</td>
</tr>
<tr>
<td>browser.targets()</td>
<td>Array(Target)</td>
<td>获取所有活动的 targets</td>
</tr>
<tr>
<td>browser.version()</td>
<td>Promise(String)</td>
<td>获取浏览器的版本</td>
</tr>
<tr>
<td>browser.wsEndpoint()</td>
<td>String</td>
<td>返回浏览器实例的 socket 连接 URL, 可以通过这个 URL 重连接 chrome 实例</td>
</tr>
</tbody></table>
<p>好了，Puppeteer 的API 就不一一介绍了，官方提供的详细的 API， <a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md">戳这里</a></p>
<h1 id="Puppeteer-实战"><a href="#Puppeteer-实战" class="headerlink" title="Puppeteer 实战"></a>Puppeteer 实战</h1><p>了解 API 之后我们就可以来一些实战了，在此之前，我们先了解一下 Puppeteer 的设计原理，简单来说 Puppeteer 跟 webdriver 以及 PhantomJS 最大的 的不同就是它是站在用户浏览的角度，而 webdriver 和 PhantomJS 最初设计就是用来做自动化测试的，所以它是站在机器浏览的角度来设计的，所以它们 使用的是不同的设计哲学。举个栗子，加入我需要打开京东的首页并进行一次产品搜索，分别看看使用 Puppeteer 和 webdriver 的实现流程：</p>
<p><strong>Puppeteer 的实现流程：</strong></p>
<ol>
<li> 打开京东首页</li>
<li> 将光标 focus 到搜索输入框</li>
<li> 键盘点击输入文字</li>
<li> 点击搜索按钮</li>
</ol>
<p><strong>webdriver 的实现流程：</strong></p>
<ol>
<li> 打开京东首页</li>
<li> 找到输入框的 input 元素</li>
<li> 设置 input 的值为要搜索文字</li>
<li> 触发搜索按钮的单机事件</li>
</ol>
<p>个人感觉 Puppeteer 设计哲学更符合任何的操作习惯，更自然一些。</p>
<p>下面我们就用一个简单的需求实现来进行 Puppeteer 的入门学习。这个简单的需求就是：</p>
<blockquote>
<p>在京东商城抓取10个手机商品，并把商品的详情页截图。</p>
</blockquote>
<p>首先我们来梳理一下操作流程</p>
<ol>
<li> 打开京东首页</li>
<li> 输入“手机”关键字并搜索</li>
<li> 获取前10个商品的 A 标签，并获取 href 属性值，获取商品详情链接</li>
<li> 分别打开10个商品的详情页，截取网页图片</li>
</ol>
<p>要实现上面的功能需要用到查找元素，获取属性，键盘事件等，那接下来我们就一个一个的讲解一下。</p>
<h2 id="1-获取元素"><a href="#1-获取元素" class="headerlink" title="1 获取元素"></a>1 获取元素</h2><p>Page 对象提供了2个 API 来获取页面元素</p>
<p>(1). Page.$(selector) 获取单个元素，底层是调用的是 document.querySelector() , 所以选择器的 selector 格式遵循 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Selectors">css 选择器规范</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> inputElement = <span class="keyword">await</span> page.$(<span class="string">&quot;#search&quot;</span>, <span class="function"><span class="params">input</span> =&gt;</span> input);</span><br><span class="line"><span class="comment">//下面写法等价</span></span><br><span class="line"><span class="keyword">let</span> inputElement = <span class="keyword">await</span> page.$(<span class="string">&#x27;#search&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>(2). Page.$$(selector) 获取一组元素，底层调用的是 document.querySelectorAll(). 返回 Promise(Array(ElemetHandle)) 元素数组.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> links = <span class="keyword">await</span> page.$$(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"><span class="comment">//下面写法等价</span></span><br><span class="line"><span class="keyword">const</span> links = <span class="keyword">await</span> page.$$(<span class="string">&quot;a&quot;</span>, <span class="function"><span class="params">links</span> =&gt;</span> links);</span><br></pre></td></tr></table></figure>

<p>最终返回的都是 ElemetHandle 对象</p>
<h2 id="2-获取元素属性"><a href="#2-获取元素属性" class="headerlink" title="2 获取元素属性"></a>2 获取元素属性</h2><p>Puppeteer 获取元素属性跟我们平时写前段的js的逻辑有点不一样，按照通常的逻辑，应该是现获取元素，然后在获取元素的属性。但是上面我们知道 获取元素的 API 最终返回的都是 ElemetHandle 对象，而你去查看 ElemetHandle 的 API 你会发现，它并没有获取元素属性的 API.</p>
<p>事实上 Puppeteer 专门提供了一套获取属性的 API， Page.$eval() 和 Page.$$eval()</p>
<p>(1). Page.$$eval(selector, pageFunction[, …args]), 获取单个元素的属性，这里的选择器 selector 跟上面 Page.$(selector) 是一样的。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="keyword">await</span> page.$eval(<span class="string">&#x27;input[name=search]&#x27;</span>, <span class="function"><span class="params">input</span> =&gt;</span> input.<span class="property">value</span>);</span><br><span class="line"><span class="keyword">const</span> href = <span class="keyword">await</span> page.$eval(<span class="string">&#x27;#a&#x27;</span>, <span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">href</span>);</span><br><span class="line"><span class="keyword">const</span> content = <span class="keyword">await</span> page.$eval(<span class="string">&#x27;.content&#x27;</span>, <span class="function"><span class="params">ele</span> =&gt;</span> ele.<span class="property">outerHTML</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-执行自定义的-JS-脚本"><a href="#3-执行自定义的-JS-脚本" class="headerlink" title="3 执行自定义的 JS 脚本"></a>3 执行自定义的 JS 脚本</h2><p>Puppeteer 的 Page 对象提供了一系列 evaluate 方法，你可以通过他们来执行一些自定义的 js 代码，主要提供了下面三个 API</p>
<blockquote>
<p>(1). page.evaluate(pageFunction, …args) 返回一个可序列化的普通对象，pageFunction 表示要在页面执行的函数， args 表示传入给 pageFunction 的参数， 下面的 pageFunction 和 args 表示同样的意思。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = <span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="number">8</span> * <span class="number">7</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(result); <span class="comment">// prints &quot;56&quot;</span></span><br></pre></td></tr></table></figure>

<p>这个方法很有用，比如我们在获取页面的截图的时候，默认是只截图当前浏览器窗口的尺寸大小，默认值是800x600，那如果我们需要获取整个网页的完整 截图是没办法办到的。Page.screenshot() 方法提供了可以设置截图区域大小的参数，那么我们只要在页面加载完了之后获取页面的宽度和高度就可以解决 这个问题了。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">	<span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;<span class="attr">headless</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">	<span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;https://jr.dayi35.com&#x27;</span>);</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">setViewport</span>(&#123;<span class="attr">width</span>:<span class="number">1920</span>, <span class="attr">height</span>:<span class="number">1080</span>&#125;);</span><br><span class="line">	<span class="keyword">const</span> documentSize = <span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			<span class="attr">width</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>,</span><br><span class="line">			height : <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span>,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;<span class="attr">path</span>:<span class="string">&quot;example.png&quot;</span>, clip : &#123;<span class="attr">x</span>:<span class="number">0</span>, <span class="attr">y</span>:<span class="number">0</span>, <span class="attr">width</span>:<span class="number">1920</span>, <span class="attr">height</span>:documentSize.<span class="property">height</span>&#125;&#125;);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(2). Page.evaluateHandle(pageFunction, …args) 在 Page 上下文执行一个 pageFunction, 返回 JSHandle 实体</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> aWindowHandle = <span class="keyword">await</span> page.evaluateHandle(<span class="function">() =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="variable language_">window</span>));</span><br><span class="line">aWindowHandle; <span class="comment">// Handle for the window object.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> aHandle = <span class="keyword">await</span> page.evaluateHandle(<span class="string">&#x27;document&#x27;</span>); <span class="comment">// Handle for the &#x27;document&#x27;.</span></span><br></pre></td></tr></table></figure>

<p>从上面的代码可以看出，page.evaluateHandle() 方法也是通过 Promise.resolve 方法直接把 Promise 的最终处理结果返回， 只不过把最后返回的对象封装成了 JSHandle 对象。本质上跟 evaluate 没有什么区别。</p>
<p>下面这段代码实现获取页面的动态（包括js动态插入的元素） HTML 代码.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> aHandle = <span class="keyword">await</span> page.evaluateHandle(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="property">body</span>);</span><br><span class="line"><span class="keyword">const</span> resultHandle = <span class="keyword">await</span> page.evaluateHandle(<span class="function"><span class="params">body</span> =&gt;</span> body.<span class="property">innerHTML</span>, aHandle);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="keyword">await</span> resultHandle.<span class="title function_">jsonValue</span>());</span><br><span class="line"><span class="keyword">await</span> resultHandle.<span class="title function_">dispose</span>();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>(3). page.evaluateOnNewDocument(pageFunction, …args), 在文档页面载入前调用 pageFunction, 如果页面中有 iframe 或者 frame, 则函数调用 的上下文环境将变成子页面的，即iframe 或者 frame, 由于是在页面加载前调用，这个函数一般是用来初始化 javascript 环境的，比如重置或者 初始化一些全局变量。</p>
</blockquote>
<h2 id="4-Page-exposeFunction"><a href="#4-Page-exposeFunction" class="headerlink" title="4 Page.exposeFunction"></a>4 Page.exposeFunction</h2><p>除此上面三个 API 之外，还有一类似的非常有用的 API， 那就是 <strong>Page.exposeFunction</strong>，这个 API 用来在页面注册全局函数，非常有用：</p>
<p>因为有时候需要在页面处理一些操作的时候需要用到一些函数，虽然可以通过 Page.evaluate() API 在页面定义函数，比如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> docSize = <span class="keyword">await</span> page.evaluate(<span class="function">()=&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">function</span> <span class="title function_">getPageSize</span>(<span class="params"></span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			<span class="attr">width</span>: <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>,</span><br><span class="line">			height : <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span>,</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> <span class="title function_">getPageSize</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>但是这样的函数不是全局的，需要在每个 evaluate 中去重新定义，无法做到代码复用，在一个就是 nodejs 有很多工具包可以很轻松的实现很复杂的功能 比如要实现 md5 加密函数，这个用纯 js 去实现就不太方便了，而用 nodejs 却是几行代码的事情。</p>
<p>下面代码实现给 Page 上下文的 window 对象添加 md5 函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"></span><br><span class="line">puppeteer.<span class="title function_">launch</span>().<span class="title function_">then</span>(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  page.<span class="title function_">on</span>(<span class="string">&#x27;console&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(msg.<span class="property">text</span>));</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">exposeFunction</span>(<span class="string">&#x27;md5&#x27;</span>, <span class="function"><span class="params">text</span> =&gt;</span></span><br><span class="line">    crypto.<span class="title function_">createHash</span>(<span class="string">&#x27;md5&#x27;</span>).<span class="title function_">update</span>(text).<span class="title function_">digest</span>(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// use window.md5 to compute hashes</span></span><br><span class="line">    <span class="keyword">const</span> myString = <span class="string">&#x27;PUPPETEER&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> myHash = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">md5</span>(myString);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`md5 of <span class="subst">$&#123;myString&#125;</span> is <span class="subst">$&#123;myHash&#125;</span>`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>可以看出，Page.exposeFunction API 使用起来是很方便的，也非常有用，在比如给 window 对象注册 readfile 全局函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line">puppeteer.<span class="title function_">launch</span>().<span class="title function_">then</span>(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  page.<span class="title function_">on</span>(<span class="string">&#x27;console&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(msg.<span class="property">text</span>));</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">exposeFunction</span>(<span class="string">&#x27;readfile&#x27;</span>, <span class="keyword">async</span> filePath =&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      fs.<span class="title function_">readFile</span>(filePath, <span class="string">&#x27;utf8&#x27;</span>, <span class="function">(<span class="params">err, text</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err)</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">          <span class="title function_">resolve</span>(text);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> page.evaluate(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">    <span class="comment">// use window.readfile to read contents of a file</span></span><br><span class="line">    <span class="keyword">const</span> content = <span class="keyword">await</span> <span class="variable language_">window</span>.<span class="title function_">readfile</span>(<span class="string">&#x27;/etc/hosts&#x27;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(content);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h1 id="Page-emulate-修改模拟器-客户端-运行配置"><a href="#Page-emulate-修改模拟器-客户端-运行配置" class="headerlink" title="Page.emulate 修改模拟器(客户端)运行配置"></a>Page.emulate 修改模拟器(客户端)运行配置</h1><p>Puppeteer 提供了一些 API 供我们修改浏览器终端的配置</p>
<ol>
<li> Page.setViewport() 修改浏览器视窗大小</li>
<li> Page.setUserAgent() 设置浏览器的 UserAgent 信息</li>
<li> Page.emulateMedia() 更改页面的CSS媒体类型，用于进行模拟媒体仿真。 可选值为 “screen”, “print”, “null”, 如果设置为 null 则表示禁用媒体仿真。</li>
<li> Page.emulate() 模拟设备，参数设备对象，比如 iPhone, Mac, Android 等</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">page.<span class="title function_">setViewport</span>(&#123;<span class="attr">width</span>:<span class="number">1920</span>, <span class="attr">height</span>:<span class="number">1080</span>&#125;); <span class="comment">//设置视窗大小为 1920x1080</span></span><br><span class="line">page.<span class="title function_">setUserAgent</span>(<span class="string">&#x27;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.90 Safari/537.36&#x27;</span>);</span><br><span class="line">page.<span class="title function_">emulateMedia</span>(<span class="string">&#x27;print&#x27;</span>); <span class="comment">//设置打印机媒体样式</span></span><br></pre></td></tr></table></figure>

<p>除此之外我们还可以模拟非 PC 机设备, 比如下面这段代码模拟 iPhone 6 访问google：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> devices = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer/DeviceDescriptors&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> iPhone = devices[<span class="string">&#x27;iPhone 6&#x27;</span>];</span><br><span class="line"></span><br><span class="line">puppeteer.<span class="title function_">launch</span>().<span class="title function_">then</span>(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">emulate</span>(iPhone);</span><br><span class="line">  <span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&#x27;https://www.google.com&#x27;</span>);</span><br><span class="line">  <span class="comment">// other actions...</span></span><br><span class="line">  <span class="keyword">await</span> browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>Puppeteer 支持很多设备模拟仿真，比如Galaxy, iPhone, IPad 等，想要知道详细设备支持，请戳这里 <a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/puppeteer/blob/master/DeviceDescriptors.js">DeviceDescriptors.js.</a></p>
<h1 id="键盘和鼠标"><a href="#键盘和鼠标" class="headerlink" title="键盘和鼠标"></a>键盘和鼠标</h1><p>键盘和鼠标的API比较简单，键盘的几个API如下：</p>
<ul>
<li>  keyboard.down(key[, options]) 触发 keydown 事件</li>
<li>  keyboard.press(key[, options]) 按下某个键，key 表示键的名称，比如 ‘ArrowLeft’ 向左键，详细的键名映射请<a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/puppeteer/blob/master/lib/USKeyboardLayout.js">戳这里</a></li>
<li>  keyboard.sendCharacter(char) 输入一个字符</li>
<li>  keyboard.type(text, options) 输入一个字符串</li>
<li>  keyboard.up(key) 触发 keyup 事件</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">page.<span class="property">keyboard</span>.<span class="title function_">press</span>(<span class="string">&quot;Shift&quot;</span>); <span class="comment">//按下 Shift 键</span></span><br><span class="line">page.<span class="property">keyboard</span>.<span class="title function_">sendCharacter</span>(<span class="string">&#x27;嗨&#x27;</span>);</span><br><span class="line">page.<span class="property">keyboard</span>.<span class="title function_">type</span>(<span class="string">&#x27;Hello&#x27;</span>); <span class="comment">// 一次输入完成</span></span><br><span class="line">page.<span class="property">keyboard</span>.<span class="title function_">type</span>(<span class="string">&#x27;World&#x27;</span>, &#123;<span class="attr">delay</span>: <span class="number">100</span>&#125;); <span class="comment">// 像用户一样慢慢输入</span></span><br></pre></td></tr></table></figure>

<p>鼠标操作：</p>
<ul>
<li>  mouse.click(x, y, [options]) 移动鼠标指针到指定的位置，然后按下鼠标，这个其实 mouse.move 和 mouse.down 或 mouse.up 的快捷操作</li>
<li>mouse.down([options]) 触发 mousedown 事件，options 可配置:<ul>
<li>  options.button 按下了哪个键，可选值为[left, right, middle], 默认是 left, 表示鼠标左键</li>
<li>  options.clickCount 按下的次数，单击，双击或者其他次数</li>
<li>  delay 按键延时时间</li>
</ul>
</li>
<li>  mouse.move(x, y, [options]) 移动鼠标到指定位置， options.steps 表示移动的步长</li>
<li>  mouse.up([options]) 触发 mouseup 事件</li>
</ul>
<h1 id="另外几个有用的-API"><a href="#另外几个有用的-API" class="headerlink" title="另外几个有用的 API"></a>另外几个有用的 API</h1><p>Puppeteer 还提供几个非常有用的 API， 比如：</p>
<h2 id="1-Page-waitFor-系列-API"><a href="#1-Page-waitFor-系列-API" class="headerlink" title="1 Page.waitFor 系列 API"></a>1 Page.waitFor 系列 API</h2><ul>
<li>  page.waitFor(selectorOrFunctionOrTimeout[, options[, …args]]) 下面三个的综合 API</li>
<li>  page.waitForFunction(pageFunction[, options[, …args]]) 等待 pageFunction 执行完成之后</li>
<li>  page.waitForNavigation(options) 等待页面基本元素加载完之后，比如同步的 HTML, CSS, JS 等代码</li>
<li>  page.waitForSelector(selector[, options]) 等待某个选择器的元素加载之后，这个元素可以是异步加载的，这个 API 非常有用，你懂的。</li>
</ul>
<p>比如我想获取某个通过 js 异步加载的元素，那么直接获取肯定是获取不到的。这个时候就可以使用 page.waitForSelector 来解决：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">await</span> page.<span class="title function_">waitForSelector</span>(<span class="string">&#x27;.gl-item&#x27;</span>); <span class="comment">//等待元素加载之后，否则获取不到异步加载的元素</span></span><br><span class="line"><span class="keyword">const</span> links = <span class="keyword">await</span> page.$$eval(<span class="string">&#x27;.gl-item &gt; .gl-i-wrap &gt; .p-img &gt; a&#x27;</span>, <span class="function"><span class="params">links</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> links.<span class="title function_">map</span>(<span class="function"><span class="params">ele</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> &#123;</span><br><span class="line">			<span class="attr">href</span>: ele.<span class="property">href</span>.<span class="title function_">trim</span>(),</span><br><span class="line">			<span class="attr">name</span>: ele.<span class="property">title</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>其实上面的代码就可以解决我们最上面的需求，抓取京东的产品，因为是异步加载的，所以使用这种方式。</p>
<h2 id="2-page-getMetrics"><a href="#2-page-getMetrics" class="headerlink" title="2 page.getMetrics()"></a>2 page.getMetrics()</h2><p>通过 page.getMetrics() 可以得到一些页面性能数据， 捕获网站的时间线跟踪，以帮助诊断性能问题。</p>
<ul>
<li>  Timestamp 度量标准采样的时间戳</li>
<li>  Documents 页面文档数</li>
<li>  Frames 页面 frame 数</li>
<li>  JSEventListeners 页面内事件监听器数</li>
<li>  Nodes 页面 DOM 节点数</li>
<li>  LayoutCount 页面布局总数</li>
<li>  RecalcStyleCount 样式重算数</li>
<li>  LayoutDuration 所有页面布局的合并持续时间</li>
<li>  RecalcStyleDuration 所有页面样式重新计算的组合持续时间。</li>
<li>  ScriptDuration 所有脚本执行的持续时间</li>
<li>  TaskDuration 所有浏览器任务时长</li>
<li>  JSHeapUsedSize JavaScript 占用堆大小</li>
<li>  JSHeapTotalSize JavaScript 堆总量</li>
</ul>
<h1 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h1><p>1.关掉无界面模式，有时查看浏览器显示的内容是很有用的。使用以下命令可以启动完整版浏览器：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;<span class="attr">headless</span>: <span class="literal">false</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>2.减慢速度，slowMo选项以指定的毫秒减慢Puppeteer的操作。这是另一个看到发生了什么的方法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> browser = <span class="keyword">await</span> puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">  <span class="attr">headless</span>:<span class="literal">false</span>,</span><br><span class="line">  <span class="attr">slowMo</span>:<span class="number">250</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>3.捕获console的输出,通过监听console事件。在page.evaluate里调试代码时这也很方便：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">page.<span class="title function_">on</span>(<span class="string">&#x27;console&#x27;</span>, <span class="function"><span class="params">msg</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; msg.<span class="property">_args</span>.<span class="property">length</span>; ++i)</span><br><span class="line">		<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`<span class="subst">$&#123;i&#125;</span>: <span class="subst">$&#123;msg._args[i]&#125;</span>`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">await</span> page.evaluate(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`url is <span class="subst">$&#123;location.href&#125;</span>`</span>));</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：在page.evaluate不能直接使用console.log()打印内容，因为打印的内容是输出到浏览器的控制台中，而不是把内容打印到终端。</p>
</blockquote>
<p>4.启动详细日志记录，所有公共API调用和内部协议流量都将通过puppeteer命名空间下的debug模块进行记录</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># <span class="title class_">Basic</span> verbose logging</span><br><span class="line">env <span class="variable constant_">DEBUG</span>=<span class="string">&quot;puppeteer:*&quot;</span> node script.<span class="property">js</span></span><br><span class="line"></span><br><span class="line"># <span class="title class_">Debug</span> output can be enabled/disabled by namespace</span><br><span class="line">env <span class="variable constant_">DEBUG</span>=<span class="string">&quot;puppeteer:*,-puppeteer:protocol&quot;</span> node script.<span class="property">js</span> # everything <span class="variable constant_">BUT</span> protocol messages</span><br><span class="line">env <span class="variable constant_">DEBUG</span>=<span class="string">&quot;puppeteer:session&quot;</span> node script.<span class="property">js</span> # protocol session messages (protocol messages to targets)</span><br><span class="line">env <span class="variable constant_">DEBUG</span>=<span class="string">&quot;puppeteer:mouse,puppeteer:keyboard&quot;</span> node script.<span class="property">js</span> # only <span class="title class_">Mouse</span> and <span class="title class_">Keyboard</span> <span class="variable constant_">API</span> calls</span><br><span class="line"></span><br><span class="line"># <span class="title class_">Protocol</span> traffic can be rather noisy. <span class="title class_">This</span> example filters out all <span class="title class_">Network</span> domain messages</span><br><span class="line">env <span class="variable constant_">DEBUG</span>=<span class="string">&quot;puppeteer:*&quot;</span> env <span class="variable constant_">DEBUG_COLORS</span>=<span class="literal">true</span> node script.<span class="property">js</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> | grep -v <span class="string">&#x27;&quot;Network&#x27;</span></span><br></pre></td></tr></table></figure>

<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><p>如果 Puppeteer 方法无法执行一个请求，就会抛出一个错误。例如，<code>page.waitForSelector(selector[, options])</code> 选择器如果在给定的时间范围内无法匹配节点，就会失败。 对于某些类型的错误，Puppeteer 使用特定的错误类处理。这些类可以通过 <code>require(&#39;puppeteer/Errors&#39;)</code> 获得。<br>一个处理超时错误的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="title class_">TimeoutError</span></span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer/Errors&#x27;</span>); <span class="comment">// ...</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">await</span> page.<span class="title function_">waitForSelector</span>(<span class="string">&#x27;.foo&#x27;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(e) &#123;</span><br><span class="line">    <span class="keyword">if</span> (e <span class="keyword">instanceof</span> <span class="title class_">TimeoutError</span>) &#123; <span class="comment">// 如果超时，做一些处理。  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="总结和源码"><a href="#总结和源码" class="headerlink" title="总结和源码"></a>总结和源码</h1><p>本文通过一个实际需求来学习了 Puppeteer 的一些基本的常用的 API， API 的版本是 v0.13.0-alpha. 最新邦本的 API 请参考 <a target="_blank" rel="noopener" href="https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md">Puppeteer 官方API</a>.</p>
<p>总的来说，Puppeteer 真是一款不错的 headless 工具，操作简单，功能强大。用来做UI自动化测试，和一些小工具都是很不错的。</p>
<p>下面贴上我们开始的需求实现源码，仅供参考：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//延时函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">sleep</span>(<span class="params">delay</span>) &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">		<span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="title function_">resolve</span>(<span class="number">1</span>)</span><br><span class="line">			&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">				<span class="title function_">reject</span>(<span class="number">0</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;, delay)</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> puppeteer = <span class="built_in">require</span>(<span class="string">&#x27;puppeteer&#x27;</span>);</span><br><span class="line">puppeteer.<span class="title function_">launch</span>(&#123;</span><br><span class="line">        <span class="comment">//如果是访问https页面 此属性会忽略https错误</span></span><br><span class="line">        <span class="attr">ignoreHTTPSErrors</span>:<span class="literal">true</span>, </span><br><span class="line">        <span class="comment">// 关闭headless模式, 不会打开浏览器界面（前提是安装了完整的chorome/chrominu,并且有界面环境）</span></span><br><span class="line">        <span class="attr">headless</span>:<span class="literal">false</span>,</span><br><span class="line">        <span class="attr">slowMo</span>:<span class="number">250</span>, </span><br><span class="line">        <span class="comment">//设置超时时间</span></span><br><span class="line">        <span class="attr">timeout</span>:<span class="number">0</span>,</span><br><span class="line">        <span class="comment">// 打开开发者工具, 当此值为true时, headless总为false</span></span><br><span class="line">        <span class="attr">devtools</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;).<span class="title function_">then</span>(<span class="keyword">async</span> browser =&gt; &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">let</span> page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>();</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">setJavaScriptEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">goto</span>(<span class="string">&quot;https://www.jd.com/&quot;</span>);</span><br><span class="line">	<span class="keyword">const</span> searchInput = <span class="keyword">await</span> page.$(<span class="string">&quot;#key&quot;</span>);</span><br><span class="line">	<span class="keyword">await</span> searchInput.<span class="title function_">focus</span>(); <span class="comment">//定位到搜索框</span></span><br><span class="line">	<span class="keyword">await</span> page.<span class="property">keyboard</span>.<span class="title function_">type</span>(<span class="string">&quot;手机&quot;</span>);</span><br><span class="line">	<span class="keyword">const</span> searchBtn = <span class="keyword">await</span> page.$(<span class="string">&quot;.button&quot;</span>);</span><br><span class="line">	<span class="keyword">await</span> searchBtn.<span class="title function_">click</span>();</span><br><span class="line">	<span class="keyword">await</span> page.<span class="title function_">waitForSelector</span>(<span class="string">&#x27;.gl-item&#x27;</span>); <span class="comment">//等待元素加载之后，否则获取不异步加载的元素</span></span><br><span class="line">	<span class="keyword">const</span> links = <span class="keyword">await</span> page.$$eval(<span class="string">&#x27;.gl-item &gt; .gl-i-wrap &gt; .p-img &gt; a&#x27;</span>, <span class="function"><span class="params">links</span> =&gt;</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> links.<span class="title function_">map</span>(<span class="function"><span class="params">a</span> =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> &#123;</span><br><span class="line">				<span class="attr">href</span>: a.<span class="property">href</span>.<span class="title function_">trim</span>(),</span><br><span class="line">				<span class="attr">title</span>: a.<span class="property">title</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;);</span><br><span class="line">	page.<span class="title function_">close</span>();</span><br><span class="line"></span><br><span class="line">	<span class="keyword">const</span> aTags = links.<span class="title function_">splice</span>(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt; aTags.<span class="property">length</span>; i++) &#123;</span><br><span class="line">		page = <span class="keyword">await</span> browser.<span class="title function_">newPage</span>()</span><br><span class="line">		page.<span class="title function_">setJavaScriptEnabled</span>(<span class="literal">true</span>);</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">setViewport</span>(&#123;<span class="attr">width</span>:<span class="number">1920</span>, <span class="attr">height</span>:<span class="number">1080</span>&#125;);</span><br><span class="line">		<span class="keyword">var</span> a = aTags[i];</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">goto</span>(a.<span class="property">href</span>, &#123;<span class="attr">timeout</span>:<span class="number">0</span>&#125;); <span class="comment">//防止页面太长，加载超时</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">//注入代码，慢慢把滚动条滑到最底部，保证所有的元素被全部加载</span></span><br><span class="line">		<span class="keyword">let</span> scrollEnable = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">let</span> scrollStep = <span class="number">500</span>; <span class="comment">//每次滚动的步长</span></span><br><span class="line">		<span class="keyword">while</span> (scrollEnable) &#123;</span><br><span class="line">			scrollEnable = <span class="keyword">await</span> page.evaluate(<span class="function">(<span class="params">scrollStep</span>) =&gt;</span> &#123;</span><br><span class="line">				<span class="keyword">let</span> scrollTop = <span class="variable language_">document</span>.<span class="property">scrollingElement</span>.<span class="property">scrollTop</span>;</span><br><span class="line">				<span class="variable language_">document</span>.<span class="property">scrollingElement</span>.<span class="property">scrollTop</span> = scrollTop + scrollStep;</span><br><span class="line">				<span class="keyword">return</span> <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">clientHeight</span> &gt; scrollTop + <span class="number">1080</span> ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">			&#125;, scrollStep);</span><br><span class="line">			<span class="keyword">await</span> <span class="title function_">sleep</span>(<span class="number">100</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">waitForSelector</span>(<span class="string">&quot;#footer-2014&quot;</span>, &#123;<span class="attr">timeout</span>:<span class="number">0</span>&#125;); <span class="comment">//判断是否到达底部了</span></span><br><span class="line">		<span class="keyword">let</span> filename = <span class="string">&quot;images/items-&quot;</span>+i+<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">		<span class="comment">//这里有个Puppeteer的bug一直没有解决，发现截图的高度最大只能是16384px， 超出部分被截掉了。</span></span><br><span class="line">		<span class="keyword">await</span> page.<span class="title function_">screenshot</span>(&#123;<span class="attr">path</span>:filename, <span class="attr">fullPage</span>:<span class="literal">true</span>&#125;);</span><br><span class="line">		page.<span class="title function_">close</span>();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	browser.<span class="title function_">close</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>《THE END》</p>
<blockquote>
<p>扩展阅读：<br><a target="_blank" rel="noopener" href="http://csbun.github.io/blog/2017/09/puppeteer/">译文：Puppeteer 与 Chrome Headless —— 从入门到爬虫</a><br><a target="_blank" rel="noopener" href="https://juejin.im/post/5a506682f265da3e474435d9">爬虫利器 Puppeteer 实战</a><br><a target="_blank" rel="noopener" href="https://zhaoqize.github.io/puppeteer-api-zh_CN/">Puppeteer中文文档</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://moqiang02.github.io/2020/06/30/Puppeteer-%E5%85%A5%E9%97%A8%E6%95%99%E7%A8%8B/" data-id="cla0v65z200v7g0v1bv3k4gkz" data-title="Puppeteer 入门教程" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Puppeteer/" rel="tag">Puppeteer</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%88%AC%E8%99%AB/" rel="tag">爬虫</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/07/01/Puppeteer%E4%BD%BF%E7%94%A8/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Puppeteer使用
        
      </div>
    </a>
  
  
    <a href="/2020/06/25/%E6%B1%82%E4%B8%8D%E6%9B%B4%E5%AD%A6%E4%B8%8D%E5%8A%A8%E4%B9%8BRedis5-0%E6%96%B0%E7%89%B9%E6%80%A7Stream%E5%B0%9D%E9%B2%9C/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">求不更学不动之Redis5.0新特性Stream尝鲜</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">255</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/apache/">apache</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github%E5%8D%9A%E5%AE%A2/">github博客</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html-css/">html+css</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iis/">iis</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">80</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">115</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">72</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">41</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">185</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83/">其它</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span class="category-list-count">51</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">开源项目</a><span class="category-list-count">73</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/">生活随笔</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/">量化交易</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AndroidStudio/" style="font-size: 13.16px;">AndroidStudio</a> <a href="/tags/AndroidUI/" style="font-size: 20px;">AndroidUI</a> <a href="/tags/Android%E4%BA%8B%E4%BB%B6%E6%8B%A6%E6%88%AA/" style="font-size: 11.05px;">Android事件拦截</a> <a href="/tags/Android%E5%BC%80%E6%BA%90/" style="font-size: 16.84px;">Android开源</a> <a href="/tags/CI/" style="font-size: 15.26px;">CI</a> <a href="/tags/CURL/" style="font-size: 12.63px;">CURL</a> <a href="/tags/DEDE/" style="font-size: 17.89px;">DEDE</a> <a href="/tags/Docker/" style="font-size: 14.21px;">Docker</a> <a href="/tags/Flask/" style="font-size: 10.53px;">Flask</a> <a href="/tags/JavaSE/" style="font-size: 18.95px;">JavaSE</a> <a href="/tags/Laravel/" style="font-size: 16.84px;">Laravel</a> <a href="/tags/Maven/" style="font-size: 11.05px;">Maven</a> <a href="/tags/MybatisPlus/" style="font-size: 11.05px;">MybatisPlus</a> <a href="/tags/Puppeteer/" style="font-size: 14.74px;">Puppeteer</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/Selenium/" style="font-size: 11.58px;">Selenium</a> <a href="/tags/SpringBoot/" style="font-size: 19.47px;">SpringBoot</a> <a href="/tags/Thinkphp/" style="font-size: 10px;">Thinkphp</a> <a href="/tags/UEditor/" style="font-size: 11.58px;">UEditor</a> <a href="/tags/VMware/" style="font-size: 12.11px;">VMware</a> <a href="/tags/Vue/" style="font-size: 17.37px;">Vue</a> <a href="/tags/WebSocket/" style="font-size: 12.63px;">WebSocket</a> <a href="/tags/ecshop/" style="font-size: 14.21px;">ecshop</a> <a href="/tags/scrapy/" style="font-size: 13.68px;">scrapy</a> <a href="/tags/smarty/" style="font-size: 12.11px;">smarty</a> <a href="/tags/socket/" style="font-size: 14.21px;">socket</a> <a href="/tags/sphinx/" style="font-size: 11.58px;">sphinx</a> <a href="/tags/vagrant/" style="font-size: 12.11px;">vagrant</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.05px;">微服务</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/" style="font-size: 15.26px;">数据传输</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 11.58px;">正则</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15.79px;">消息队列</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 18.42px;">爬虫</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 16.32px;">集群</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/04/20/Spring-boot-admin-%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7%E5%88%A9%E5%99%A8/">Spring boot admin 服务监控利器</a>
          </li>
        
          <li>
            <a href="/2023/04/16/%E6%8E%A8%E9%80%81%E4%BB%A3%E7%A0%81%E5%88%B0-GitHub-%E4%BB%93%E5%BA%93%E5%87%BA%E9%94%99%EF%BC%9AWARNING-REMOTE-HOST-IDENTIFICATION-HAS-CHANGED/">推送代码到 GitHub 仓库出错：WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!</a>
          </li>
        
          <li>
            <a href="/2023/04/16/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F%E4%BD%BF%E7%94%A8%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8Ffinal%E9%97%AE%E9%A2%98/">lambda表达式使用局部变量final问题</a>
          </li>
        
          <li>
            <a href="/2023/02/24/Java%E6%96%B9%E6%B3%95%E4%BC%A0%E5%8F%82%E5%88%B0%E5%BA%95%E4%BC%A0%E6%89%80%E9%9C%80%E5%8F%82%E6%95%B0%E5%A5%BD%E8%BF%98%E6%98%AF%E4%BC%A0%E5%AE%9E%E4%BD%93%E5%A5%BD%EF%BC%9F/">Java方法传参到底传所需参数好还是传实体好？</a>
          </li>
        
          <li>
            <a href="/2023/02/09/Java8%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E4%B8%AD%E7%9A%84%E6%96%B0%E6%96%B9%E6%B3%95/">Java8集合框架中的新方法</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 moqiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>

<!-- rex -->

<script src="/js/toc.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>