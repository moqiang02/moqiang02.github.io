<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>RxJava 与 Retrofit 结合的最佳实践 | 自强不息</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="RxJava和Retrofit也火了一段时间了，不过最近一直在学习ReactNative和Node相关的姿势，一直没有时间研究这些新东西，最近有个项目准备写，打算先用Android写一个Demo出来，却发现Android的世界发生了天翻地覆的变化，EventBus和OKHttp啥的都不见了，RxJava和Retrofit是什么鬼？">
<meta property="og:type" content="article">
<meta property="og:title" content="RxJava 与 Retrofit 结合的最佳实践">
<meta property="og:url" content="http://moqiang02.github.io/2016/04/23/RxJava-%E4%B8%8E-Retrofit-%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="自强不息">
<meta property="og:description" content="RxJava和Retrofit也火了一段时间了，不过最近一直在学习ReactNative和Node相关的姿势，一直没有时间研究这些新东西，最近有个项目准备写，打算先用Android写一个Demo出来，却发现Android的世界发生了天翻地覆的变化，EventBus和OKHttp啥的都不见了，RxJava和Retrofit是什么鬼？">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://moqiang02.github.io/images/RxJava%E4%B8%8ERetrofit%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/1.jpg">
<meta property="article:published_time" content="2016-04-23T15:59:15.000Z">
<meta property="article:modified_time" content="2022-10-26T09:28:53.880Z">
<meta property="article:author" content="moqiang">
<meta property="article:tag" content="Android开源">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://moqiang02.github.io/images/RxJava%E4%B8%8ERetrofit%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/1.jpg">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">自强不息</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://moqiang02.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-RxJava-与-Retrofit-结合的最佳实践" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2016/04/23/RxJava-%E4%B8%8E-Retrofit-%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" class="article-date">
  <time class="dt-published" datetime="2016-04-23T15:59:15.000Z" itemprop="datePublished">2016-04-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/android/">android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      RxJava 与 Retrofit 结合的最佳实践
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      

          <!-- rex -->
          
            <!-- 文章目录开始 -->
            
              <div id="toc" class="toc-article">
              <strong class="toc-title" style="cursor:pointer">目录</strong>
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-RxJava%E5%A6%82%E4%BD%95%E4%B8%8ERetrofit%E7%BB%93%E5%90%88"><span class="toc-number">1.</span> <span class="toc-text">1.RxJava如何与Retrofit结合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E5%9F%BA%E6%9C%AC%E9%A1%B5%E9%9D%A2"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 基本页面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E5%8F%AA%E7%94%A8Retrofit"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 只用Retrofit</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%B7%BB%E5%8A%A0Rxjava"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 添加Rxjava</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-%E5%B0%86%E8%AF%B7%E6%B1%82%E8%BF%87%E7%A8%8B%E8%BF%9B%E8%A1%8C%E5%B0%81%E8%A3%85"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 将请求过程进行封装</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E7%9B%B8%E5%90%8C%E6%A0%BC%E5%BC%8F%E7%9A%84Http%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E8%AF%A5%E5%A6%82%E4%BD%95%E5%B0%81%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2.相同格式的Http请求数据该如何封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E7%9B%B8%E5%90%8C%E6%A0%BC%E5%BC%8F%E7%9A%84Http%E8%AF%B7%E6%B1%82%E6%95%B0%E6%8D%AE%E7%BB%9F%E4%B8%80%E8%BF%9B%E8%A1%8C%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">3.相同格式的Http请求数据统一进行预处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%A6%82%E4%BD%95%E5%8F%96%E6%B6%88%E4%B8%80%E4%B8%AAHttp%E8%AF%B7%E6%B1%82-%E2%80%93-%E8%A7%82%E5%AF%9F%E8%80%85%E4%B9%8B%E9%97%B4%E7%9A%84%E5%AF%B9%E5%86%B3%EF%BC%8CObserver-VS-Subscriber"><span class="toc-number">4.</span> <span class="toc-text">4.如何取消一个Http请求 – 观察者之间的对决，Observer VS Subscriber</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-%E5%8F%96%E6%B6%88%E4%B8%80%E4%B8%AAHttp%E8%AF%B7%E6%B1%82"><span class="toc-number">4.1.</span> <span class="toc-text">4.1 取消一个Http请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E6%8F%90%E5%88%B0Oberver"><span class="toc-number">4.2.</span> <span class="toc-text">4.2 为什么会提到Oberver</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-%E4%B8%80%E4%B8%AA%E9%9C%80%E8%A6%81ProgressDialog%E7%9A%84Subscriber%E8%AF%A5%E6%9C%89%E7%9A%84%E6%A0%B7%E5%AD%90"><span class="toc-number">5.</span> <span class="toc-text">5.一个需要ProgressDialog的Subscriber该有的样子</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1%E5%A4%84%E7%90%86onNext"><span class="toc-number">5.1.</span> <span class="toc-text">5.1处理onNext</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2%E5%A4%84%E7%90%86ProgressDialog"><span class="toc-number">5.2.</span> <span class="toc-text">5.2处理ProgressDialog</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E"><span class="toc-number">6.</span> <span class="toc-text">最后</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E6%9C%80%E5%90%8E"><span class="toc-number">7.</span> <span class="toc-text">最后的最后</span></a></li></ol>
              </div>
            
            <!-- 文章目录结束 -->	  
          

        <p>RxJava和Retrofit也火了一段时间了，不过最近一直在学习ReactNative和Node相关的姿势，一直没有时间研究这些新东西，最近有个项目准备写，打算先用Android写一个Demo出来，却发现Android的世界发生了天翻地覆的变化，EventBus和OKHttp啥的都不见了，RxJava和Retrofit是什么鬼？<span id="more"></span></p>
<p>好吧，到Github上耐着性子看过了RxJava和Retrofit的介绍和几个Demo，原来Android的大神Jake Wharton为Retrofit这个项目贡献了这么多的代码，没有道理不用了。</p>
<p>如果你对RxJava不熟悉请先看<a target="_blank" rel="noopener" href="http://gank.io/post/560e15be2dca930e00da1083">给 Android 开发者的 RxJava 详解</a>这篇文章。</p>
<p>如果你对Retrofit不熟悉就先看<a target="_blank" rel="noopener" href="http://square.github.io/retrofit">Retrofit官网</a>。</p>
<p>当然也有很多RxJava与Retrofit的文章，但是我觉得很多大家都很纠结的功能都没有被总结出来，所以才有了此篇文章。</p>
<p>欢迎大家拍砖。</p>
<p>接下来进入正文，我是从下面几个角度去思考RxJava与Retrofit结合的。</p>
<ul>
<li>RxJava如何与Retrofit结合</li>
<li>相同格式的Http请求数据该如何封装</li>
<li>相同格式的Http请求数据统一进行预处理</li>
<li>如何取消一个Http请求 – 观察者之间的对决，Oberver VS Subscriber</li>
<li>一个需要ProgressDialog的Subscriber该有的样子</li>
</ul>
<h3 id="1-RxJava如何与Retrofit结合"><a href="#1-RxJava如何与Retrofit结合" class="headerlink" title="1.RxJava如何与Retrofit结合"></a>1.RxJava如何与Retrofit结合</h3><h4 id="1-1-基本页面"><a href="#1-1-基本页面" class="headerlink" title="1.1 基本页面"></a>1.1 基本页面</h4><p>先扔出build.gradle文件的内容</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">dependencies</span> &#123;</span><br><span class="line">    <span class="keyword">compile</span> <span class="keyword">fileTree</span>(dir: <span class="string">&#x27;libs&#x27;</span>, <span class="keyword">include</span>: [<span class="string">&#x27;*.jar&#x27;</span>])</span><br><span class="line">    testCompile <span class="string">&#x27;junit:junit:4.12&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.android.support:appcompat-v7:23.2.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;io.reactivex:rxjava:1.1.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;io.reactivex:rxandroid:1.1.0&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:retrofit:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:converter-gson:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.squareup.retrofit2:adapter-rxjava:2.0.0-beta4&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.google.code.gson:gson:2.6.2&#x27;</span></span><br><span class="line">    <span class="keyword">compile</span> <span class="string">&#x27;com.jakewharton:butterknife:7.0.1&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是说本文是基于RxJava1.1.0和Retrofit 2.0.0-beta4来进行的。 添加rxandroid是因为rxjava中的线程问题。</p>
<p>下面先搭建一个基本的页面，页面很简单，先来看文件目录结构<br><img src="/images/RxJava%E4%B8%8ERetrofit%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/1.jpg"></p>
<p>activity_main.xml的代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">RelativeLayout</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">&quot;http://schemas.android.com/tools&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingBottom</span>=<span class="string">&quot;@dimen/activity_vertical_margin&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingLeft</span>=<span class="string">&quot;@dimen/activity_horizontal_margin&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingRight</span>=<span class="string">&quot;@dimen/activity_horizontal_margin&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:paddingTop</span>=<span class="string">&quot;@dimen/activity_vertical_margin&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:context</span>=<span class="string">&quot;.activity.MainActivity&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/click_me_BN&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;wrap_content&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_alignParentBottom</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:padding</span>=<span class="string">&quot;5dp&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;点我&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;16sp&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">&quot;@+id/result_TV&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">&quot;match_parent&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_above</span>=<span class="string">&quot;@id/click_me_BN&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:text</span>=<span class="string">&quot;Hello World!&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:textSize</span>=<span class="string">&quot;16sp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>MainActivity.java的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.queen.rxjavaretrofitdemo.activity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> android.os.Bundle;</span><br><span class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</span><br><span class="line"><span class="keyword">import</span> android.widget.Button;</span><br><span class="line"><span class="keyword">import</span> android.widget.TextView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.queen.rxjavaretrofitdemo.R;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> butterknife.Bind;</span><br><span class="line"><span class="keyword">import</span> butterknife.ButterKnife;</span><br><span class="line"><span class="keyword">import</span> butterknife.OnClick;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bind(R.id.click_me_BN)</span></span><br><span class="line">    Button clickMeBN;</span><br><span class="line">    <span class="meta">@Bind(R.id.result_TV)</span></span><br><span class="line">    TextView resultTV;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ButterKnife.bind(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OnClick(R.id.click_me_BN)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">()</span> &#123;</span><br><span class="line">        getMovie();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行网络请求</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getMovie</span><span class="params">()</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意不要忘记加网络权限</p>
<p><code>&lt;uses-permission android:name=&quot;android.permission.INTERNET&quot;/&gt;</code></p>
<h4 id="1-2-只用Retrofit"><a href="#1-2-只用Retrofit" class="headerlink" title="1.2 只用Retrofit"></a>1.2 只用Retrofit</h4><p>我们准备在getMovie方法中进行网络请求，我们先来看看只使用Retrofit是如何进行的。</p>
<p>我们使用豆瓣电影的Top250做测试连接，目标地址为<br><a target="_blank" rel="noopener" href="https://api.douban.com/v2/movie/top250?start=0&amp;count=10">https://api.douban.com/v2/movie/top250?start=0&amp;count=10</a></p>
<p>至于返回的数据格式，大家自己访问下链接就看到了，太长就不放进来了。</p>
<p>首先我们要根据返回的结果封装一个Entity，暂命名为MovieEntity，代码就不贴了。</p>
<p>接下来我们要创建一个接口取名为MovieService，代码如下：</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">MovieService</span> &#123;</span><br><span class="line">    <span class="variable">@GET</span>(<span class="string">&quot;top250&quot;</span>)</span><br><span class="line">    Call&lt;MovieEntity&gt; <span class="built_in">getTopMovie</span>(<span class="variable">@Query</span>(<span class="string">&quot;start&quot;</span>) int start, <span class="variable">@Query</span>(<span class="string">&quot;count&quot;</span>) int count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>回到MainActivity之中，我们来写getMovie方法的代码</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进行网络请求</span></span><br><span class="line"><span class="keyword">private</span> void get<span class="constructor">Movie()</span>&#123;</span><br><span class="line">    String baseUrl = <span class="string">&quot;https://api.douban.com/v2/movie/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Retrofit retrofit = <span class="keyword">new</span> Retrofit.<span class="constructor">Builder()</span></span><br><span class="line">            .base<span class="constructor">Url(<span class="params">baseUrl</span>)</span></span><br><span class="line">            .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">            .build<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">    MovieService movieService = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">MovieService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">    Call&lt;MovieEntity&gt; call = movieService.get<span class="constructor">TopMovie(0, 10)</span>;</span><br><span class="line">    call.enqueue(<span class="keyword">new</span> Callback&lt;MovieEntity&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Response(Call&lt;MovieEntity&gt; <span class="params">call</span>, Response&lt;MovieEntity&gt; <span class="params">response</span>)</span> &#123;</span><br><span class="line">            resultTV.set<span class="constructor">Text(<span class="params">response</span>.<span class="params">body</span>()</span>.<span class="keyword">to</span><span class="constructor">String()</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Failure(Call&lt;MovieEntity&gt; <span class="params">call</span>, Throwable <span class="params">t</span>)</span> &#123;</span><br><span class="line">            resultTV.set<span class="constructor">Text(<span class="params">t</span>.<span class="params">getMessage</span>()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上为没有经过封装的、原生态的Retrofit写网络请求的代码。 我们可以封装创建Retrofit和service部分的代码，然后Activity用创建一个Callback作为参数给Call，这样Activity中只关注请求的结果，而且Call有cancel方法可以取消一个请求，好像没Rxjava什么事了，我觉得可以写到这就下班了~</p>
<p>接下来我们要面对的问题是这样的 如果我的Http返回数据是一个统一的格式，例如</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;resultCode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;resultMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们如何对返回结果进行一个统一的处理呢？</p>
<p>另外，我的ProgressDialog的show方法应该在哪调用呢？看样子只能在getMovie()这个方法里面调用了，换个地方发出请求就要在对应的Listener里面写一遍show()的代码，其实挺闹心。</p>
<p>而且错误请求我也想集中处理掉不要贴重复的代码。</p>
<p>我们先来看结合了Rxjava之后，事情有没有变化的可能。当然即便是不用Rxjava，依旧能够做很多的封装，只是比较麻烦。</p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step1</p>
<h4 id="1-3-添加Rxjava"><a href="#1-3-添加Rxjava" class="headerlink" title="1.3 添加Rxjava"></a>1.3 添加Rxjava</h4><p>Retrofit本身对Rxjava提供了支持。</p>
<p>添加Retrofit对Rxjava的支持需要在Gradle文件中添加</p>
<p><code>compile &#39;com.squareup.retrofit2:adapter-rxjava:2.0.0-beta4&#39;</code></p>
<p>当然我们已经添加过了。</p>
<p>然后在创建Retrofit的过程中添加如下代码：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = <span class="keyword">new</span> Retrofit.<span class="constructor">Builder()</span></span><br><span class="line">        .base<span class="constructor">Url(<span class="params">baseUrl</span>)</span></span><br><span class="line">        .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">        .add<span class="constructor">CallAdapterFactory(RxJavaCallAdapterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">        .build<span class="literal">()</span>;</span><br></pre></td></tr></table></figure>
<p>这样一来我们定义的service返回值就不在是一个Call了，而是一个Observable</p>
<p>重新定义MovieService</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">public</span> <span class="selector-tag">interface</span> <span class="selector-tag">MovieService</span> &#123;</span><br><span class="line">    <span class="variable">@GET</span>(<span class="string">&quot;top250&quot;</span>)</span><br><span class="line">    Observable&lt;MovieEntity&gt; <span class="built_in">getTopMovie</span>(<span class="variable">@Query</span>(<span class="string">&quot;start&quot;</span>) int start, <span class="variable">@Query</span>(<span class="string">&quot;count&quot;</span>) int count);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getMovie方法改为：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//进行网络请求</span></span><br><span class="line"><span class="keyword">private</span> void get<span class="constructor">Movie()</span>&#123;</span><br><span class="line">    String baseUrl = <span class="string">&quot;https://api.douban.com/v2/movie/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Retrofit retrofit = <span class="keyword">new</span> Retrofit.<span class="constructor">Builder()</span></span><br><span class="line">            .base<span class="constructor">Url(<span class="params">baseUrl</span>)</span></span><br><span class="line">            .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">            .add<span class="constructor">CallAdapterFactory(RxJavaCallAdapterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">            .build<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">    MovieService movieService = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">MovieService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line"></span><br><span class="line">    movieService.get<span class="constructor">TopMovie(0, 10)</span></span><br><span class="line">            .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">            .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">            .subscribe(<span class="keyword">new</span> Subscriber&lt;MovieEntity&gt;<span class="literal">()</span> &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public void on<span class="constructor">Completed()</span> &#123;</span><br><span class="line">                    <span class="module-access"><span class="module"><span class="identifier">Toast</span>.</span></span>make<span class="constructor">Text(MainActivity.<span class="params">this</span>, <span class="string">&quot;Get Top Movie Completed&quot;</span>, Toast.LENGTH_SHORT)</span>.show<span class="literal">()</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void on<span class="constructor">Error(Throwable <span class="params">e</span>)</span> &#123;</span><br><span class="line">                    resultTV.set<span class="constructor">Text(<span class="params">e</span>.<span class="params">getMessage</span>()</span>);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                public void on<span class="constructor">Next(MovieEntity <span class="params">movieEntity</span>)</span> &#123;</span><br><span class="line">                    resultTV.set<span class="constructor">Text(<span class="params">movieEntity</span>.<span class="params">toString</span>()</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样基本上就完成了Retrofit和Rxjava的结合，但是我知道你们当然不会满意的。</p>
<p>接下来我们把创建Retrofit的过程封装一下，然后希望Activity创建Subscriber对象传进来。</p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step2</p>
<h4 id="1-4-将请求过程进行封装"><a href="#1-4-将请求过程进行封装" class="headerlink" title="1.4 将请求过程进行封装"></a>1.4 将请求过程进行封装</h4><p>创建一个对象HttpMethods</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">public <span class="keyword">class</span> HttpMethods &#123;</span><br><span class="line"></span><br><span class="line">    public static final String BASE_URL = <span class="string">&quot;https://api.douban.com/v2/movie/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> static final <span class="built_in">int</span> DEFAULT_TIMEOUT = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Retrofit retrofit;</span><br><span class="line">    <span class="keyword">private</span> MovieService movieService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造方法私有</span></span><br><span class="line">    <span class="keyword">private</span> <span class="constructor">HttpMethods()</span> &#123;</span><br><span class="line">        <span class="comment">//手动创建一个OkHttpClient并设置超时时间</span></span><br><span class="line">        OkHttpClient.Builder httpClientBuilder = <span class="keyword">new</span> OkHttpClient.<span class="constructor">Builder()</span>;</span><br><span class="line">        httpClientBuilder.connect<span class="constructor">Timeout(DEFAULT_TIMEOUT, TimeUnit.SECONDS)</span>;</span><br><span class="line"></span><br><span class="line">        retrofit = <span class="keyword">new</span> Retrofit.<span class="constructor">Builder()</span></span><br><span class="line">                .client(httpClientBuilder.build<span class="literal">()</span>)</span><br><span class="line">                .add<span class="constructor">ConverterFactory(GsonConverterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">                .add<span class="constructor">CallAdapterFactory(RxJavaCallAdapterFactory.<span class="params">create</span>()</span>)</span><br><span class="line">                .base<span class="constructor">Url(BASE_URL)</span></span><br><span class="line">                .build<span class="literal">()</span>;</span><br><span class="line"></span><br><span class="line">        movieService = retrofit.create(<span class="module-access"><span class="module"><span class="identifier">MovieService</span>.</span></span><span class="keyword">class</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在访问HttpMethods时创建单例</span></span><br><span class="line">    <span class="keyword">private</span> static <span class="keyword">class</span> SingletonHolder&#123;</span><br><span class="line">        <span class="keyword">private</span> static final HttpMethods INSTANCE = <span class="keyword">new</span> <span class="constructor">HttpMethods()</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取单例</span></span><br><span class="line">    public static HttpMethods get<span class="constructor">Instance()</span>&#123;</span><br><span class="line">        return SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用于获取豆瓣电影Top250的数据</span></span><br><span class="line"><span class="comment">     * @param subscriber 由调用者传过来的观察者对象</span></span><br><span class="line"><span class="comment">     * @param start 起始位置</span></span><br><span class="line"><span class="comment">     * @param count 获取长度</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    public void get<span class="constructor">TopMovie(Subscriber&lt;MovieEntity&gt; <span class="params">subscriber</span>, <span class="params">int</span> <span class="params">start</span>, <span class="params">int</span> <span class="params">count</span>)</span>&#123;</span><br><span class="line">        movieService.get<span class="constructor">TopMovie(<span class="params">start</span>, <span class="params">count</span>)</span></span><br><span class="line">                .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">                .unsubscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">                .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">                .subscribe(subscriber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>用一个单例来封装该对象，在构造方法中创建Retrofit和对应的Service。 如果需要访问不同的基地址，那么你可能需要创建多个Retrofit对象，或者干脆根据不同的基地址封装不同的HttpMethod类。</p>
<p>我们回头再来看MainActivity中的getMovie方法：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> void get<span class="constructor">Movie()</span>&#123;</span><br><span class="line">     subscriber = <span class="keyword">new</span> Subscriber&lt;MovieEntity&gt;<span class="literal">()</span> &#123;</span><br><span class="line">         @Override</span><br><span class="line">         public void on<span class="constructor">Completed()</span> &#123;</span><br><span class="line">             <span class="module-access"><span class="module"><span class="identifier">Toast</span>.</span></span>make<span class="constructor">Text(MainActivity.<span class="params">this</span>, <span class="string">&quot;Get Top Movie Completed&quot;</span>, Toast.LENGTH_SHORT)</span>.show<span class="literal">()</span>;</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public void on<span class="constructor">Error(Throwable <span class="params">e</span>)</span> &#123;</span><br><span class="line">             resultTV.set<span class="constructor">Text(<span class="params">e</span>.<span class="params">getMessage</span>()</span>);</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         @Override</span><br><span class="line">         public void on<span class="constructor">Next(MovieEntity <span class="params">movieEntity</span>)</span> &#123;</span><br><span class="line">             resultTV.set<span class="constructor">Text(<span class="params">movieEntity</span>.<span class="params">toString</span>()</span>);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;;</span><br><span class="line">     <span class="module-access"><span class="module"><span class="identifier">HttpMethods</span>.</span></span>get<span class="constructor">Instance()</span>.get<span class="constructor">TopMovie(<span class="params">subscriber</span>, 0, 10)</span>;</span><br><span class="line">&#125;        </span><br></pre></td></tr></table></figure>
<p>其中subscriber是MainActivity的成员变量。</p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step3</p>
<h3 id="2-相同格式的Http请求数据该如何封装"><a href="#2-相同格式的Http请求数据该如何封装" class="headerlink" title="2.相同格式的Http请求数据该如何封装"></a>2.相同格式的Http请求数据该如何封装</h3><p>第二部分和第三部分我参考了知乎上的一个问答： <a target="_blank" rel="noopener" href="https://www.zhihu.com/question/39182019">RxJava+Retrofit，在联网返回后如何先进行统一的判断？</a> 不过没有完整的示例，所以在这写一个完整的示例出来。</p>
<p>这个段落我们来聊一下有些Http服务返回一个固定格式的数据的问题。 例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;resultCode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;resultMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>大部分的Http服务可能都是这样设置，resultCode和resultMessage的内容相对比较稳定，而data的内容变化多端，72变都不一定够变的，有可能是个User对象，也有可能是个订单对象，还有可能是个订单列表。 按照我们之前的用法，使用Gson转型需要我们在创建subscriber对象是指定返回值类型，如果我们对不同的返回值进行封装的话，那可能就要有上百个Entity了，看着明明是很清晰的结构，却因为data的不确定性无奈了起来。</p>
<p>少年，不必烦恼，来来来~ 老衲赐你宝典葵花，老衲就是练了这个才出家。。。</p>
<p>我们可以创建一个HttpResult类</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">HttpResult</span>&lt;<span class="symbol">T</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> resultCode;</span><br><span class="line">    <span class="keyword">private</span> String resultMessage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果data是一个User对象的话。那么在定义Service方法的返回值就可以写为</p>
<p><code>Observable&lt;HttpResult&lt;User&gt;&gt;</code></p>
<p>这样一来HttpResult就相当于一个包装类，将结果包装了起来，但是在使用的时候要给出一个明确的类型。</p>
<p>在上面的示例中，我也创建了一个HttpResult类，用来模仿这个形式，将其中的Subject单独封装了起来。</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="symbol">HttpResult</span>&lt;<span class="symbol">T</span>&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来模仿resultCode和resultMessage</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> count;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> start;</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> total;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用来模仿Data</span></span><br><span class="line">    <span class="keyword">private</span> T subjects;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样泛型的时候就要写为：</p>
<p><code>Observable&lt;HttpResult&lt;List&lt;Subject&gt;&gt;&gt;</code></p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step4</p>
<h3 id="3-相同格式的Http请求数据统一进行预处理"><a href="#3-相同格式的Http请求数据统一进行预处理" class="headerlink" title="3.相同格式的Http请求数据统一进行预处理"></a>3.相同格式的Http请求数据统一进行预处理</h3><p>既然我们有了相同的返回格式，那么我们可能就需要在获得数据之后进行一个统一的预处理。</p>
<p>当接收到了一个Http请求结果之后，由于返回的结构统一为</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line"> <span class="attr">&quot;resultCode&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;resultMessage&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line"> <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们想要对resultCode和resultMessage先做一个判断，因为如果<code>resultCode == 0</code>代表success，那么<code>resultCode != 0</code>时data一般都是null。</p>
<p>Activity或Fragment对resultCode和resultMessage基本没有兴趣，他们只对请求状态和data数据感兴趣。</p>
<p>基于这种考虑，我们在<code>resultCode != 0</code>的时候，抛出个自定义的ApiException。这样就会进入到subscriber的onError中，我们可以在onError中处理错误信息。</p>
<p>另外，请求成功时，需要将data数据转换为目标数据类型传递给subscriber，因为，Activity和Fragment只想拿到和他们真正相关的数据。</p>
<p>使用Observable的map方法可以完成这一功能。</p>
<p>在HttpMethods中创建一个内部类HttpResultFunc，代码如下：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用来统一处理Http的resultCode,并将HttpResult的Data部分剥离出来返回给subscriber</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param &lt;T&gt; Subscriber真正需要的数据类型，也就是Data部分的数据类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="symbol">HttpResultFunc</span>&lt;<span class="symbol">T</span>&gt; <span class="symbol">implements</span> <span class="symbol">Func1</span>&lt;<span class="symbol">HttpResult</span>&lt;<span class="symbol">T</span>&gt;, <span class="symbol">T</span>&gt;&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    <span class="keyword">public</span> T call(HttpResult&lt;T&gt; httpResult) &#123;</span><br><span class="line">        <span class="keyword">if</span> (httpResult.getResultCode() != <span class="number">0</span>) &#123;</span><br><span class="line">            throw new ApiException(httpResult.getResultCode());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> httpResult.getData();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们的getTopMovie方法改为：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public void get<span class="constructor">TopMovie(Subscriber&lt;List&lt;Subject&gt;&gt; <span class="params">subscriber</span>, <span class="params">int</span> <span class="params">start</span>, <span class="params">int</span> <span class="params">count</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    movieService.get<span class="constructor">TopMovie(<span class="params">start</span>, <span class="params">count</span>)</span></span><br><span class="line">            .map(<span class="keyword">new</span> HttpResultFunc&lt;List&lt;Subject&gt;&gt;<span class="literal">()</span>)</span><br><span class="line">            .subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">            .unsubscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">            .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">            .subscribe(subscriber);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>由于HttpResult中的泛型T就是我们希望传递给subscriber的数据类型，而数据可以通过httpResult的getData方法获得，这样我们就处理了泛型问题，错误处理问题，还有将请求数据部分剥离出来给subscriber</p>
<p>这样我们只需要关注Data数据的类型，而不必在关心整个过程了。</p>
<p>需要注意一点，就是在定义Service的时候，泛型是</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">HttpResult</span>&lt;<span class="type">User</span>&gt;</span><br><span class="line"><span class="comment">//or</span></span><br><span class="line"><span class="type">HttpResult</span>&lt;<span class="type">List</span>&lt;<span class="type">Subject</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>而在定义Subscriber的时候泛型是 <code>java User //or List&lt;Subject&gt;</code></p>
<p>不然你会得到一个转型错误。</p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step5</p>
<p>代码中我是用豆瓣数据模拟了HttpResult中的resultCode和resultMessage，与文档中的代码略有出入。</p>
<h3 id="4-如何取消一个Http请求-–-观察者之间的对决，Observer-VS-Subscriber"><a href="#4-如何取消一个Http请求-–-观察者之间的对决，Observer-VS-Subscriber" class="headerlink" title="4.如何取消一个Http请求 – 观察者之间的对决，Observer VS Subscriber"></a>4.如何取消一个Http请求 – 观察者之间的对决，Observer VS Subscriber</h3><h4 id="4-1-取消一个Http请求"><a href="#4-1-取消一个Http请求" class="headerlink" title="4.1 取消一个Http请求"></a>4.1 取消一个Http请求</h4><p>这一部分我们来聊一下关于取消Http请求的事情，已经Oberver和Subscriber这两个体位我们哪个更容易给我们G点。</p>
<p>如果没有使用Rxjava，那么Service返回的是一个Call，而这个Call对象有一个cancel方法可以用来取消Http请求。那么用了Rxjava之后，如何来取消一个请求呢？因为返回值是一个Observable。我们能做的似乎只有解除对Observable对象的订阅，其他的什么也做不了。</p>
<p>好在Retrofit已经帮我们考虑到了这一点。 答案在RxJavaCallAdapterFactory这个类的源码中可以找到</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">class</span> CallOnSubscribe&lt;T&gt; <span class="keyword">implements</span> Observable.OnSubscribe&lt;Response&lt;T&gt;&gt; &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">Call</span>&lt;T&gt; originalCall;</span><br><span class="line"></span><br><span class="line">  CallOnSubscribe(<span class="keyword">Call</span>&lt;T&gt; originalCall) &#123;</span><br><span class="line">    <span class="keyword">this</span>.originalCall = originalCall;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override <span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">call</span>(<span class="keyword">final</span> Subscriber&lt;? <span class="keyword">super</span> Response&lt;T&gt;&gt; subscriber) &#123;</span><br><span class="line">    <span class="comment">// Since Call is a one-shot type, clone it for each new subscriber.</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">Call</span>&lt;T&gt; <span class="keyword">call</span> = originalCall.clone();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Attempt to cancel the call if it is still in-flight on unsubscription.</span></span><br><span class="line">    subscriber.add(Subscriptions.create(<span class="keyword">new</span> Action0() &#123;</span><br><span class="line">      @Override <span class="keyword">public</span> <span class="keyword">void</span> <span class="keyword">call</span>() &#123;</span><br><span class="line">        <span class="keyword">call</span>.cancel();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      Response&lt;T&gt; response = <span class="keyword">call</span>.execute();</span><br><span class="line">      <span class="keyword">if</span> (!subscriber.isUnsubscribed()) &#123;</span><br><span class="line">        subscriber.onNext(response);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">      Exceptions.throwIfFatal(t);</span><br><span class="line">      <span class="keyword">if</span> (!subscriber.isUnsubscribed()) &#123;</span><br><span class="line">        subscriber.onError(t);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!subscriber.isUnsubscribed()) &#123;</span><br><span class="line">      subscriber.onCompleted();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们看到call方法中，给subscriber添加了一个Subscription对象，Subscription对象很简单，主要就是取消订阅用的，如果你查看Subscriptions.create的源码，发现是这样的</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="function">Subscription <span class="title">create</span><span class="params">(<span class="keyword">final</span> Action0 unsubscribe)</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">return</span> BooleanSubscription.<span class="title">create</span><span class="params">(unsubscribe)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>利用了一个BooleanSubscription类来创建一个Subscription，如果你点进去看BooleanSubscription.create方法一切就清晰了，当接触绑定的时候，subscriber会调用Subscription的unsubscribe方法，然后触发创建Subscription时候的传递进来的Action0的call方法。RxJavaCallAdapterFactory帮我们给subscriber添加的是call.cancel()，总结起来就是说，我们在Activity或者Fragment中创建subscriber对象，想要取消请求的时候调用subscriber的unsubscribe方法就可以了。</p>
<p>对不起这一节有太多的Subscriber和Subscription以及Observer和Observable，老衲当时看的时候也是不知道吐了多少次了，习惯了就好了。</p>
<h4 id="4-2-为什么会提到Oberver"><a href="#4-2-为什么会提到Oberver" class="headerlink" title="4.2 为什么会提到Oberver"></a>4.2 为什么会提到Oberver</h4><p>提到Observer的过程是这样的。由于Subscriber一旦调用了unsubscribe方法之后，就没有用了。且当事件传递到onError或者onCompleted之后，也会自动的解绑。这样出现的一个问题就是每次发送请求都要创建新的Subscriber对象。</p>
<p>这样我们就把注意力放到了Observer，Observer本身是一个接口，他的特性是不管你怎么用，都不会解绑，为什么呢？因为他没有解绑的方法。所以就达到了复用的效果，一开始我一直美滋滋的用Observer。事实上，如果你用的是Observer，在调用Observable对象的subscribe方法的时候，会自动的将Observer对象转换成Subscriber对象。</p>
<p>下面是源码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> final <span class="title class_">Subscription</span> <span class="title function_">subscribe</span>(<span class="params">final Observer&lt;? <span class="variable language_">super</span> T&gt; observer</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (observer <span class="keyword">instanceof</span> <span class="title class_">Subscriber</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">subscribe</span>((<span class="title class_">Subscriber</span>&lt;? <span class="variable language_">super</span> T&gt;)observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">subscribe</span>(<span class="keyword">new</span> <span class="title class_">Subscriber</span>&lt;T&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">            observer.<span class="title function_">onCompleted</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">            observer.<span class="title function_">onError</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">T t</span>) &#123;</span><br><span class="line">            observer.<span class="title function_">onNext</span>(t);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>后来发现了问题<br>问题1 无法取消，因为Observer没有unsubscribe方法<br>问题2 没有onStart方法 这个一会聊</p>
<p>这两个问题是很痛苦的。所以，为了后面更好的高潮，我们还是选择用Subscriber。</p>
<h3 id="5-一个需要ProgressDialog的Subscriber该有的样子"><a href="#5-一个需要ProgressDialog的Subscriber该有的样子" class="headerlink" title="5.一个需要ProgressDialog的Subscriber该有的样子"></a>5.一个需要ProgressDialog的Subscriber该有的样子</h3><p>我们希望有一个Subscriber在我们每次发送请求的时候能够弹出一个ProgressDialog，然后在请求接受的时候让这个ProgressDialog消失，同时在我们取消这个ProgressDialog的同时能够取消当前的请求，而我们只需要处理里面的数据就可以了。</p>
<p>我们先来创建一个类，就叫ProgressSubscriber，让他继承Subscriber。</p>
<p>Subscriber给我们提供了onStart、onNext、onError、onCompleted四个方法。</p>
<p>其中只有onNext方法返回了数据，那我们自然希望能够在onNext里面处理数据相关的逻辑。</p>
<p>onStart方法我们用来启动一个ProgressDialog。 onError方法我们集中处理错误，同时也停止ProgressDialog onComplated方法里面停止ProgressDialog</p>
<p>其中我们需要解决两个问题</p>
<p>问题1 onNext的处理<br>问题2 cancel掉一个ProgressDialog的时候取消请求</p>
<p>我们先来解决问题1</p>
<h4 id="5-1处理onNext"><a href="#5-1处理onNext" class="headerlink" title="5.1处理onNext"></a>5.1处理onNext</h4><p>我们希望这里能够让Activity或者Fragment自己处理onNext之后的逻辑，很自然的我们想到了用接口。问题还是泛型的问题，这里面我们必须指定明确的类型。所以接口还是需要泛型。</p>
<p>我们先来定义一个接口，命名SubscriberOnNextListener</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SubscriberOnNextListener</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="built_in">void</span> <span class="title function_">onNext</span>(T t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">代码很简单。再来看一下<span class="title class_">ProgressSubscriber</span>现在的代码</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProgressSubscriber</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Subscriber</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">SubscriberOnNextListener</span> mSubscriberOnNextListener;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Context</span> context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ProgressSubscriber</span>(<span class="title class_">SubscriberOnNextListener</span> mSubscriberOnNextListener, <span class="title class_">Context</span> context) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mSubscriberOnNextListener</span> = mSubscriberOnNextListener;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">context</span> = context;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(context, <span class="string">&quot;Get Top Movie Completed&quot;</span>, <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">        <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(context, <span class="string">&quot;error:&quot;</span> + e.<span class="title function_">getMessage</span>(), <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">T t</span>) &#123;</span><br><span class="line">        mSubscriberOnNextListener.<span class="title function_">onNext</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我知道传Context不好，不过为了演示而已，大家可以自己封装一下Toast。</p>
<p>MainActivity使用是这样的：</p>
<p>先来定义一个SubscriberOnNextListener对象，可以在onCreate里面创建这个对象</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SubscriberOnNextListener getTopMovieOnNext;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected void on<span class="constructor">Create(Bundle <span class="params">savedInstanceState</span>)</span> &#123;</span><br><span class="line">    super.on<span class="constructor">Create(<span class="params">savedInstanceState</span>)</span>;</span><br><span class="line">    set<span class="constructor">ContentView(R.<span class="params">layout</span>.<span class="params">activity_main</span>)</span>;</span><br><span class="line">    <span class="module-access"><span class="module"><span class="identifier">ButterKnife</span>.</span></span>bind(this);</span><br><span class="line"></span><br><span class="line">    getTopMovieOnNext = <span class="keyword">new</span> SubscriberOnNextListener&lt;List&lt;Subject&gt;&gt;<span class="literal">()</span> &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void on<span class="constructor">Next(List&lt;Subject&gt; <span class="params">subjects</span>)</span> &#123;</span><br><span class="line">            resultTV.set<span class="constructor">Text(<span class="params">subjects</span>.<span class="params">toString</span>()</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>getMovie方法这么写：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">getMovie</span>()</span>&#123;</span><br><span class="line"> HttpMethods.getInstance().getTopMovie(</span><br><span class="line">  <span class="keyword">new</span> ProgressSubscriber(getTopMovieOnNext, MainActivity.<span class="keyword">this</span>), </span><br><span class="line">  <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样Activity或Fragment就只需要关注拿到结果之后的逻辑了，其他的完全不用操心。</p>
<p>如需查看项目代码 –&gt; 代码地址:<br><a target="_blank" rel="noopener" href="https://github.com/tough1985/RxjavaRetrofitDemo">https://github.com/tough1985/RxjavaRetrofitDemo</a><br>选择Tag -&gt; step6</p>
<h4 id="5-2处理ProgressDialog"><a href="#5-2处理ProgressDialog" class="headerlink" title="5.2处理ProgressDialog"></a>5.2处理ProgressDialog</h4><p>我们希望当cancel掉ProgressDialog的时候，能够取消订阅，也就取消了当前的Http请求。 所以我们先来创建个接口来处理这件事情。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ProgressCancelListener</span> &#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">onCancelProgress</span>()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我们用ProgressSubscriber来实现这个接口，这样ProgressSubscriber就有了一个onCancelProgress方法，在这里面取消订阅。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCancelProgress</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isUnsubscribed</span>()) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">unsubscribe</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后我用了一个Handler来封装了ProgressDialog。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProgressDialogHandler</span> <span class="keyword">extends</span> <span class="title">Handler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SHOW_PROGRESS_DIALOG = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DISMISS_PROGRESS_DIALOG = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ProgressDialog pd;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Context context;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> cancelable;</span><br><span class="line">    <span class="keyword">private</span> ProgressCancelListener mProgressCancelListener;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProgressDialogHandler</span><span class="params">(Context context, ProgressCancelListener mProgressCancelListener,</span></span></span><br><span class="line"><span class="params"><span class="function">                                 <span class="keyword">boolean</span> cancelable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="keyword">this</span>.context = context;</span><br><span class="line">        <span class="keyword">this</span>.mProgressCancelListener = mProgressCancelListener;</span><br><span class="line">        <span class="keyword">this</span>.cancelable = cancelable;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">initProgressDialog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pd == <span class="keyword">null</span>) &#123;</span><br><span class="line">            pd = <span class="keyword">new</span> ProgressDialog(context);</span><br><span class="line"></span><br><span class="line">            pd.setCancelable(cancelable);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cancelable) &#123;</span><br><span class="line">                pd.setOnCancelListener(<span class="keyword">new</span> DialogInterface.OnCancelListener() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onCancel</span><span class="params">(DialogInterface dialogInterface)</span> </span>&#123;</span><br><span class="line">                        mProgressCancelListener.onCancelProgress();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!pd.isShowing()) &#123;</span><br><span class="line">                pd.show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">void</span> <span class="title">dismissProgressDialog</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (pd != <span class="keyword">null</span>) &#123;</span><br><span class="line">            pd.dismiss();</span><br><span class="line">            pd = <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">handleMessage</span><span class="params">(Message msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (msg.what) &#123;</span><br><span class="line">            <span class="keyword">case</span> SHOW_PROGRESS_DIALOG:</span><br><span class="line">                initProgressDialog();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> DISMISS_PROGRESS_DIALOG:</span><br><span class="line">                dismissProgressDialog();</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Handler接收两个消息来控制显示Dialog还是关闭Dialog。 创建Handler的时候我们需要传入ProgressCancelListener的对象实例。</p>
<p>最后贴出ProgressSubscriber的完整代码：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProgressSubscriber</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Subscriber</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">ProgressCancelListener</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">SubscriberOnNextListener</span> mSubscriberOnNextListener;</span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">ProgressDialogHandler</span> mProgressDialogHandler;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title class_">Context</span> context;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title class_">ProgressSubscriber</span>(<span class="title class_">SubscriberOnNextListener</span> mSubscriberOnNextListener, <span class="title class_">Context</span> context) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">mSubscriberOnNextListener</span> = mSubscriberOnNextListener;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">context</span> = context;</span><br><span class="line">        mProgressDialogHandler = <span class="keyword">new</span> <span class="title class_">ProgressDialogHandler</span>(context, <span class="variable language_">this</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">showProgressDialog</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (mProgressDialogHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">            mProgressDialogHandler.<span class="title function_">obtainMessage</span>(<span class="title class_">ProgressDialogHandler</span>.<span class="property">SHOW_PROGRESS_DIALOG</span>).<span class="title function_">sendToTarget</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">void</span> <span class="title function_">dismissProgressDialog</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (mProgressDialogHandler != <span class="literal">null</span>) &#123;</span><br><span class="line">            mProgressDialogHandler.<span class="title function_">obtainMessage</span>(<span class="title class_">ProgressDialogHandler</span>.<span class="property">DISMISS_PROGRESS_DIALOG</span>).<span class="title function_">sendToTarget</span>();</span><br><span class="line">            mProgressDialogHandler = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onStart</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">showProgressDialog</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCompleted</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">dismissProgressDialog</span>();</span><br><span class="line">        <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(context, <span class="string">&quot;Get Top Movie Completed&quot;</span>, <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onError</span>(<span class="params">Throwable e</span>) &#123;</span><br><span class="line">        <span class="title function_">dismissProgressDialog</span>();</span><br><span class="line">        <span class="title class_">Toast</span>.<span class="title function_">makeText</span>(context, <span class="string">&quot;error:&quot;</span> + e.<span class="title function_">getMessage</span>(), <span class="title class_">Toast</span>.<span class="property">LENGTH_SHORT</span>).<span class="title function_">show</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onNext</span>(<span class="params">T t</span>) &#123;</span><br><span class="line">        mSubscriberOnNextListener.<span class="title function_">onNext</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCancelProgress</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable language_">this</span>.<span class="title function_">isUnsubscribed</span>()) &#123;</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">unsubscribe</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前为止，就封装完毕了。以上是我在用Rxjava和Retrofit过程中踩过的一些坑，最后整合出来的，由于没有在实际的项目中跑过，有问题的话希望能够提出来大家讨论一下，拍砖也欢迎。</p>
<p>现在我们再写一个新的网络请求，步骤是这样的： 1. 在Service中定义一个新的方法。 2. 在HttpMethods封装对应的请求（代码基本可以copy） 3. 创建一个SubscriberOnNextListener处理请求数据并刷新UI。</p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>如果你觉得写更改线程的代码觉得也很烦的话，可以把订阅这部分也封装起来：</p>
<figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public void get<span class="constructor">TopMovie(Subscriber&lt;List&lt;Subject&gt;&gt; <span class="params">subscriber</span>, <span class="params">int</span> <span class="params">start</span>, <span class="params">int</span> <span class="params">count</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//原来的样子</span></span><br><span class="line"><span class="comment">// movieService.getTopMovie(start, count)</span></span><br><span class="line"><span class="comment">// .map(new HttpResultFunc&lt;List&lt;Subject&gt;&gt;())</span></span><br><span class="line"><span class="comment">// .subscribeOn(Schedulers.io())</span></span><br><span class="line"><span class="comment">// .unsubscribeOn(Schedulers.io())</span></span><br><span class="line"><span class="comment">// .observeOn(AndroidSchedulers.mainThread())</span></span><br><span class="line"><span class="comment">// .subscribe(subscriber);</span></span><br><span class="line"></span><br><span class="line"> <span class="comment">//修改之后的样子</span></span><br><span class="line">    Observable observable = movieService.get<span class="constructor">TopMovie(<span class="params">start</span>, <span class="params">count</span>)</span></span><br><span class="line">            .map(<span class="keyword">new</span> HttpResultFunc&lt;List&lt;Subject&gt;&gt;<span class="literal">()</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">to</span><span class="constructor">Subscribe(<span class="params">observable</span>, <span class="params">subscriber</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//添加线程管理并订阅</span></span><br><span class="line"><span class="keyword">private</span> void <span class="keyword">to</span><span class="constructor">Subscribe(Observable <span class="params">o</span>, Subscriber <span class="params">s</span>)</span>&#123;</span><br><span class="line">     o.subscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">            .unsubscribe<span class="constructor">On(Schedulers.<span class="params">io</span>()</span>)</span><br><span class="line">            .observe<span class="constructor">On(AndroidSchedulers.<span class="params">mainThread</span>()</span>)</span><br><span class="line">            .subscribe(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>让你每次写一个请求的时候，写的代码尽量少，更多的精力放在业务逻辑本身。</p>
<h3 id="最后的最后"><a href="#最后的最后" class="headerlink" title="最后的最后"></a>最后的最后</h3><p>如果你的httpResult格式本身没有问题，但是data中的内容是这样的：</p>
<figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;resultCode&quot;</span>: <span class="number">0</span>,</span><br><span class="line"> <span class="string">&quot;resultMessage&quot;</span>: <span class="string">&quot;成功&quot;</span>,</span><br><span class="line"> <span class="string">&quot;data&quot;</span>: &#123;<span class="string">&quot;user&quot;</span>: &#123;&#125;, <span class="string">&quot;orderArray&quot;</span>: []&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样的情况还能不能继续使用这样的框架呢？ 我的解决方法是封装一个类，把user和orderArray作为类的属性。 但是如果你的服务器一会data本身是一个完整的user数据，一会又是这样： <code>&quot;data&quot;: &#123;&quot;user&quot;: &#123;&#125;, &quot;orderArray&quot;: []&#125;</code>那我觉得你有必要跟你的服务端好好聊聊了，请他吃顿饭和顿酒，大不了献出菊花就是了。</p>
<p>但是如果服务已经上线了！！！</p>
<p>对不起，骚年……</p>
<p>老衲会在你坟前念300遍Thinking in java替你超度的~</p>
<p>希望你用Retrofit和Rxjava的新体位能够享受到新的高潮。</p>
<blockquote>
<p>转自：<a target="_blank" rel="noopener" href="http://gank.io/post/56e80c2c677659311bed9841">http://gank.io/post/56e80c2c677659311bed9841</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://moqiang02.github.io/2016/04/23/RxJava-%E4%B8%8E-Retrofit-%E7%BB%93%E5%90%88%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/" data-id="cla0v65zw00y7g0v1hs2y8wto" data-title="RxJava 与 Retrofit 结合的最佳实践" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Android%E5%BC%80%E6%BA%90/" rel="tag">Android开源</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/04/26/Android%E5%AE%A2%E6%88%B7%E7%AB%AF%E5%92%8C%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8Token%E5%92%8CSession/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Android客户端和服务端如何使用Token和Session
        
      </div>
    </a>
  
  
    <a href="/2016/04/23/RxJava%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%B0%8F%E7%BB%93/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">RxJava使用场景小结</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">255</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/apache/">apache</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github%E5%8D%9A%E5%AE%A2/">github博客</a><span class="category-list-count">18</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html-css/">html+css</a><span class="category-list-count">25</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iis/">iis</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">82</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">121</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">72</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">41</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">185</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83/">其它</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span class="category-list-count">51</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">开源项目</a><span class="category-list-count">73</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/">生活随笔</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/">量化交易</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AndroidStudio/" style="font-size: 13.16px;">AndroidStudio</a> <a href="/tags/AndroidUI/" style="font-size: 20px;">AndroidUI</a> <a href="/tags/Android%E4%BA%8B%E4%BB%B6%E6%8B%A6%E6%88%AA/" style="font-size: 11.05px;">Android事件拦截</a> <a href="/tags/Android%E5%BC%80%E6%BA%90/" style="font-size: 16.84px;">Android开源</a> <a href="/tags/CI/" style="font-size: 15.26px;">CI</a> <a href="/tags/CURL/" style="font-size: 12.63px;">CURL</a> <a href="/tags/DEDE/" style="font-size: 17.37px;">DEDE</a> <a href="/tags/Docker/" style="font-size: 14.21px;">Docker</a> <a href="/tags/Flask/" style="font-size: 10.53px;">Flask</a> <a href="/tags/JavaSE/" style="font-size: 18.95px;">JavaSE</a> <a href="/tags/Laravel/" style="font-size: 16.84px;">Laravel</a> <a href="/tags/Maven/" style="font-size: 11.05px;">Maven</a> <a href="/tags/MybatisPlus/" style="font-size: 11.05px;">MybatisPlus</a> <a href="/tags/Puppeteer/" style="font-size: 14.74px;">Puppeteer</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/Selenium/" style="font-size: 11.58px;">Selenium</a> <a href="/tags/SpringBoot/" style="font-size: 19.47px;">SpringBoot</a> <a href="/tags/Thinkphp/" style="font-size: 10px;">Thinkphp</a> <a href="/tags/UEditor/" style="font-size: 11.58px;">UEditor</a> <a href="/tags/VMware/" style="font-size: 12.11px;">VMware</a> <a href="/tags/Vue/" style="font-size: 18.42px;">Vue</a> <a href="/tags/WebSocket/" style="font-size: 12.63px;">WebSocket</a> <a href="/tags/ecshop/" style="font-size: 14.21px;">ecshop</a> <a href="/tags/scrapy/" style="font-size: 13.68px;">scrapy</a> <a href="/tags/smarty/" style="font-size: 12.11px;">smarty</a> <a href="/tags/socket/" style="font-size: 14.21px;">socket</a> <a href="/tags/sphinx/" style="font-size: 11.58px;">sphinx</a> <a href="/tags/vagrant/" style="font-size: 12.11px;">vagrant</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.05px;">微服务</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/" style="font-size: 15.26px;">数据传输</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 11.58px;">正则</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15.79px;">消息队列</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 17.89px;">爬虫</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 16.32px;">集群</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/03/19/%E6%8B%A6%E6%88%AA%E5%99%A8%E4%B8%AD%E6%B3%A8%E5%85%A5%EF%BC%88-Autowire-Resource%EF%BC%89%E5%AF%B9%E8%B1%A1%E6%8A%A5%E7%A9%BA%E6%8C%87%E9%92%88%E5%BC%82%E5%B8%B8/">拦截器中注入（@Autowire/@Resource）对象报空指针异常</a>
          </li>
        
          <li>
            <a href="/2023/10/22/margin-top%E5%A1%8C%E9%99%B7%E9%97%AE%E9%A2%98%E7%9A%84%E7%8E%B0%E8%B1%A1%E4%B8%8E%E8%A7%A3%E5%86%B3%E7%9A%84%E5%85%B7%E4%BD%93%E6%96%B9%E6%B3%95/">margin-top塌陷问题的现象与解决的具体方法</a>
          </li>
        
          <li>
            <a href="/2023/09/19/JSON-%E4%B8%8E-Java-%E5%AF%B9%E8%B1%A1%E4%B9%8B%E9%97%B4%E7%9A%84%E8%BD%AC%E5%8C%96/">JSON 与 Java 对象之间的转化</a>
          </li>
        
          <li>
            <a href="/2023/09/19/element-ui%E4%B8%ADel-table%E7%9A%84%E8%B7%A8%E8%A1%8C%EF%BC%8C%E5%90%88%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97%E6%96%B9%E5%BC%8F/">element-ui中el-table的跨行，合并行计算方式</a>
          </li>
        
          <li>
            <a href="/2023/09/19/vue-element-ui%E8%A1%A8%E6%A0%BC%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E8%A1%A8%E5%A4%B4/">vue+element ui表格实现动态表头</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 moqiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>

<!-- rex -->

<script src="/js/toc.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>