<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆäºŒï¼‰ä¸€æ–‡å¸¦ä½ SpringBoot+RabbitMQæ–¹å¼æ”¶å‘æ¶ˆæ¯ | è‡ªå¼ºä¸æ¯</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="æ¥”å­æœ¬ç¯‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—RabbitMQçš„ç¬¬äºŒå¼¹ã€‚ ä¸Šä¸€ç¯‡çš„ç»“å°¾æˆ‘ä¹Ÿé¢„å‘Šäº†æœ¬ç¯‡çš„å†…å®¹ï¼šåˆ©ç”¨RabbitTemplateå’Œæ³¨è§£è¿›è¡Œæ”¶å‘æ¶ˆæ¯ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸´æ—¶åŠ ä¸Šçš„å†…å®¹ï¼šæ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢ã€‚ æœ¬ç¯‡ä¼šå’ŒSpringBootåšæ•´åˆï¼Œé‡‡ç”¨è‡ªåŠ¨é…ç½®çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜RabbitMQåœ°å€å°±å¯ä»¥äº†ï¼Œå…³äºå„ç§åˆ›å»ºè¿æ¥å…³é—­è¿æ¥çš„äº‹éƒ½ç”±Springå¸®æˆ‘ä»¬äº†~ äº¤ç»™Springå¸®æˆ‘ä»¬ç®¡ç†è¿æ¥å¯ä»¥è®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œå°±">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆäºŒï¼‰ä¸€æ–‡å¸¦ä½ SpringBoot+RabbitMQæ–¹å¼æ”¶å‘æ¶ˆæ¯">
<meta property="og:url" content="http://moqiang02.github.io/2022/09/29/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%89%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0SpringBoot-RabbitMQ%E6%96%B9%E5%BC%8F%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF/index.html">
<meta property="og:site_name" content="è‡ªå¼ºä¸æ¯">
<meta property="og:description" content="æ¥”å­æœ¬ç¯‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—RabbitMQçš„ç¬¬äºŒå¼¹ã€‚ ä¸Šä¸€ç¯‡çš„ç»“å°¾æˆ‘ä¹Ÿé¢„å‘Šäº†æœ¬ç¯‡çš„å†…å®¹ï¼šåˆ©ç”¨RabbitTemplateå’Œæ³¨è§£è¿›è¡Œæ”¶å‘æ¶ˆæ¯ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸´æ—¶åŠ ä¸Šçš„å†…å®¹ï¼šæ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢ã€‚ æœ¬ç¯‡ä¼šå’ŒSpringBootåšæ•´åˆï¼Œé‡‡ç”¨è‡ªåŠ¨é…ç½®çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜RabbitMQåœ°å€å°±å¯ä»¥äº†ï¼Œå…³äºå„ç§åˆ›å»ºè¿æ¥å…³é—­è¿æ¥çš„äº‹éƒ½ç”±Springå¸®æˆ‘ä»¬äº†~ äº¤ç»™Springå¸®æˆ‘ä»¬ç®¡ç†è¿æ¥å¯ä»¥è®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œå°±">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/0.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/1.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/2.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/3.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/4.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/5.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/6.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/7.png">
<meta property="og:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/8.png">
<meta property="article:published_time" content="2022-09-29T02:27:31.000Z">
<meta property="article:modified_time" content="2022-11-21T06:33:03.422Z">
<meta property="article:author" content="moqiang">
<meta property="article:tag" content="æ¶ˆæ¯é˜Ÿåˆ—">
<meta property="article:tag" content="SpringBoot">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://moqiang02.github.io/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/0.png">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">è‡ªå¼ºä¸æ¯</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="æœç´¢"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://moqiang02.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆäºŒï¼‰ä¸€æ–‡å¸¦ä½ SpringBoot-RabbitMQæ–¹å¼æ”¶å‘æ¶ˆæ¯" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/09/29/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%89%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0SpringBoot-RabbitMQ%E6%96%B9%E5%BC%8F%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF/" class="article-date">
  <time class="dt-published" datetime="2022-09-29T02:27:31.000Z" itemprop="datePublished">2022-09-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/java/">java</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆäºŒï¼‰ä¸€æ–‡å¸¦ä½ SpringBoot+RabbitMQæ–¹å¼æ”¶å‘æ¶ˆæ¯
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      

          <!-- rex -->
          
            <!-- æ–‡ç« ç›®å½•å¼€å§‹ -->
            
              <div id="toc" class="toc-article">
              <strong class="toc-title" style="cursor:pointer">ç›®å½•</strong>
              <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A5%94%E5%AD%90"><span class="toc-number">1.</span> <span class="toc-text">æ¥”å­</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%F0%9F%94%8D%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">1. ğŸ”ç¯å¢ƒé…ç½®</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%F0%9F%93%95%E7%94%9F%E4%BA%A7%E8%80%85%E4%B8%8ERabbitTemplate"><span class="toc-number">3.</span> <span class="toc-text">2. ğŸ“•ç”Ÿäº§è€…ä¸RabbitTemplate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%F0%9F%93%97%E6%B6%88%E8%B4%B9%E8%80%85%E4%B8%8ERabbitListener"><span class="toc-number">4.</span> <span class="toc-text">3. ğŸ“—æ¶ˆè´¹è€…ä¸RabbitListener</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%F0%9F%93%96SpringBoot-%E5%90%AF%E5%8A%A8%EF%BC%81"><span class="toc-number">5.</span> <span class="toc-text">4. ğŸ“–SpringBoot å¯åŠ¨ï¼</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%F0%9F%93%98-RabbitListener%E4%B8%8E-RabbitHandler"><span class="toc-number">6.</span> <span class="toc-text">5. ğŸ“˜@RabbitListenerä¸@RabbitHandler</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%F0%9F%93%99%E6%B6%88%E6%81%AF%E7%9A%84%E5%BA%8F%E5%88%97%E5%8C%96%E8%BD%AC%E6%8D%A2"><span class="toc-number">7.</span> <span class="toc-text">6. ğŸ“™æ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">8.</span> <span class="toc-text">åè®°</span></a></li></ol>
              </div>
            
            <!-- æ–‡ç« ç›®å½•ç»“æŸ -->	  
          

        <h2 id="æ¥”å­"><a href="#æ¥”å­" class="headerlink" title="æ¥”å­"></a>æ¥”å­</h2><p>æœ¬ç¯‡æ˜¯æ¶ˆæ¯é˜Ÿåˆ—RabbitMQçš„ç¬¬äºŒå¼¹ã€‚</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/6856571028496351239" title="https://juejin.im/post/6856571028496351239">ä¸Šä¸€ç¯‡</a>çš„ç»“å°¾æˆ‘ä¹Ÿé¢„å‘Šäº†æœ¬ç¯‡çš„å†…å®¹ï¼šåˆ©ç”¨RabbitTemplateå’Œæ³¨è§£è¿›è¡Œæ”¶å‘æ¶ˆæ¯ï¼Œè¿˜æœ‰ä¸€ä¸ªæˆ‘ä¸´æ—¶åŠ ä¸Šçš„å†…å®¹ï¼šæ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢ã€‚</p>
<p>æœ¬ç¯‡ä¼šå’ŒSpringBootåšæ•´åˆï¼Œé‡‡ç”¨è‡ªåŠ¨é…ç½®çš„æ–¹å¼è¿›è¡Œå¼€å‘ï¼Œæˆ‘ä»¬åªéœ€è¦å£°æ˜RabbitMQåœ°å€å°±å¯ä»¥äº†ï¼Œå…³äºå„ç§åˆ›å»ºè¿æ¥å…³é—­è¿æ¥çš„äº‹éƒ½ç”±Springå¸®æˆ‘ä»¬äº†~</p>
<p>äº¤ç»™Springå¸®æˆ‘ä»¬ç®¡ç†è¿æ¥å¯ä»¥è®©æˆ‘ä»¬ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘ï¼Œå°±åƒå£°æ˜å¼äº‹åŠ¡ä¸€æ ·æ˜“ç”¨ï¼Œæ–¹ä¾¿åˆé«˜æ•ˆã€‚<span id="more"></span></p>
<p><strong>æœ¬æ–‡ä»£ç ï¼š</strong> <a target="_blank" rel="noopener" href="https://gitee.com/he-erduo/spring-boot-learning-demo">ç äº‘åœ°å€</a>â€ƒ<a target="_blank" rel="noopener" href="https://github.com/he-erduo/spring-boot-learning-demo">GitHubåœ°å€</a></p>
<p><strong>Tip</strong>ï¼šä¸Šä¸€ç¯‡çš„ä»£ç éƒ½æ”¾åœ¨<code>prototype</code>åŒ…ä¸‹ï¼Œæœ¬ç¯‡çš„ä»£ç éƒ½æ”¾åœ¨<code>auto</code>åŒ…ä¸‹é¢ã€‚</p>
<h2 id="1-ğŸ”ç¯å¢ƒé…ç½®"><a href="#1-ğŸ”ç¯å¢ƒé…ç½®" class="headerlink" title="1. ğŸ”ç¯å¢ƒé…ç½®"></a>1. ğŸ”ç¯å¢ƒé…ç½®</h2><p>ç¬¬ä¸€èŠ‚æˆ‘ä»¬å…ˆæ¥æä¸€ä¸‹ç¯å¢ƒçš„é…ç½®ï¼Œä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å·²ç»å¼•å…¥äº†è‡ªåŠ¨é…ç½®çš„åŒ…ï¼Œæˆ‘ä»¬æ—¢ç„¶ä½¿ç”¨äº†è‡ªåŠ¨é…ç½®çš„æ–¹å¼ï¼Œé‚£<code>RabbitMQ</code>çš„è¿æ¥ä¿¡æ¯æˆ‘ä»¬ç›´æ¥æ”¾åœ¨é…ç½®æ–‡ä»¶ä¸­å°±è¡Œäº†ï¼Œå°±åƒæˆ‘ä»¬éœ€è¦ç”¨åˆ°JDBCè¿æ¥çš„æ—¶å€™å»é…ç½®ä¸€ä¸‹<code>DataSource</code>ä¸€æ ·ã€‚</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/0.png"></p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åªéœ€è¦æŒ‡æ˜ä¸€ä¸‹è¿æ¥çš„IP+ç«¯å£å·å’Œç”¨æˆ·åå¯†ç å°±è¡Œäº†ï¼Œè¿™é‡Œæˆ‘ç”¨çš„æ˜¯é»˜è®¤çš„ç”¨æˆ·åä¸å¯†ç ï¼Œä¸å†™çš„è¯é»˜è®¤ä¹Ÿéƒ½æ˜¯guestï¼Œç«¯å£å·ä¹Ÿæ˜¯é»˜è®¤5672ã€‚</p>
<p>ä¸»è¦æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯çš„é…ç½®ï¼Œéœ€è¦é…ç½®æˆ<code>manual</code>æ‰æ˜¯æ‰‹åŠ¨ç¡®è®¤ï¼Œæ—¥åè¿˜ä¼šæœ‰å…¶ä»–çš„é…ç½®é¡¹ï¼Œçœ¼ä¸‹æˆ‘ä»¬é…ç½®è¿™ä¸€ä¸ªå°±å¯ä»¥äº†ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¦é…ç½®ä¸€ä¸ª<code>Queue</code>ï¼Œä¸Šä¸€ç¯‡ä¸­æˆ‘ä»¬å¾€ä¸€ä¸ªåå«<code>erduo</code>çš„é˜Ÿåˆ—ä¸­å‘é€æ¶ˆæ¯ï¼Œå½“æ—¶æ˜¯æˆ‘ä»¬æ‰‹åŠ¨å®šä¹‰çš„æ­¤é˜Ÿåˆ—ï¼Œè¿™é‡Œæˆ‘ä»¬ä¹Ÿéœ€è¦æ‰‹åŠ¨é…ç½®ï¼Œå£°æ˜ä¸€ä¸ª<code>Bean</code>å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitmqConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Queue <span class="title function_">erduo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å…¶ä¸‰ä¸ªå‚æ•°ï¼šdurable exclusive autoDelete</span></span><br><span class="line">        <span class="comment">// ä¸€èˆ¬åªè®¾ç½®ä¸€ä¸‹æŒä¹…åŒ–å³å¯</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;erduo&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å°±è¿™ä¹ˆç®€å•å£°æ˜ä¸€ä¸‹å°±å¯ä»¥äº†ï¼Œå½“ç„¶äº†<code>RabbitMQ</code>æ¯•ç«Ÿæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ç»„ä»¶ï¼Œå¦‚æœä½ åœ¨<code>RabbitMQ</code>ä¸­é€šè¿‡å…¶ä»–æ–¹å¼å·²ç»åˆ›å»ºè¿‡ä¸€ä¸ªåå«<code>erduo</code>çš„é˜Ÿåˆ—äº†ï¼Œä½ è¿™é‡Œä¹Ÿå¯ä»¥ä¸å£°æ˜ï¼Œè¿™é‡Œèµ·åˆ°çš„ä¸€ä¸ªæ•ˆæœå°±æ˜¯å¦‚æœä½ æ²¡æœ‰è¿™ä¸ªé˜Ÿåˆ—ï¼Œä¼šæŒ‰ç…§ä½ å£°æ˜çš„æ–¹å¼å¸®ä½ åˆ›å»ºè¿™ä¸ªé˜Ÿåˆ—ã€‚</p>
<p>é…ç½®å®Œç¯å¢ƒä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥SpringBootçš„æ–¹å¼æ¥ç¼–å†™ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…äº†ã€‚</p>
<h2 id="2-ğŸ“•ç”Ÿäº§è€…ä¸RabbitTemplate"><a href="#2-ğŸ“•ç”Ÿäº§è€…ä¸RabbitTemplate" class="headerlink" title="2. ğŸ“•ç”Ÿäº§è€…ä¸RabbitTemplate"></a>2. ğŸ“•ç”Ÿäº§è€…ä¸RabbitTemplate</h2><p>å’Œä¸Šä¸€ç¯‡çš„èŠ‚å¥ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆæ¥ç¼–å†™ç”Ÿäº§è€…ï¼Œä¸è¿‡è¿™æ¬¡æˆ‘è¦å¼•å…¥ä¸€ä¸ªæ–°çš„å·¥å…·ï¼š<code>RabbitTemplate</code>ã€‚</p>
<p>å¬å®ƒçš„è¿™ä¸ªåå­—å°±çŸ¥é“ï¼Œåˆæ˜¯ä¸€ä¸ªæ‹¿æ¥å³ç”¨çš„å·¥å…·ç±»ï¼ŒSpringå®¶æ—è¿™ç‚¹å°±å¾ˆèˆ’æœï¼Œä»€ä¹ˆä¸œè¥¿éƒ½ç»™ä½ å°è£…ä¸€éï¼Œè®©ä½ ç”¨èµ·æ¥æ›´æ–¹ä¾¿æ›´é¡ºæ‰‹ã€‚</p>
<p><code>RabbitTemplate</code>å®ç°äº†æ ‡å‡†AmqpTemplateæ¥å£ï¼ŒåŠŸèƒ½å¤§è‡´å¯ä»¥åˆ†ä¸ºå‘é€æ¶ˆæ¯å’Œæ¥å—æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬è¿™é‡Œæ˜¯åœ¨ç”Ÿäº§è€…ä¸­æ¥ç”¨ï¼Œä¸»è¦å°±æ˜¯ä½¿ç”¨å®ƒçš„å‘é€æ¶ˆæ¯åŠŸèƒ½ï¼š<code>send</code>å’Œ<code>convertAndSend</code>æ–¹æ³•ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‘é€æ¶ˆæ¯åˆ°é»˜è®¤çš„Exchangeï¼Œä½¿ç”¨é»˜è®¤çš„routing key</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">send</span><span class="params">(Message message)</span> <span class="keyword">throws</span> AmqpException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æŒ‡å®šçš„routing keyå‘é€æ¶ˆæ¯åˆ°é»˜è®¤çš„exchange</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String routingKey, Message message)</span> <span class="keyword">throws</span> AmqpException;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨æŒ‡å®šçš„routing keyå‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„exchange</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String exchange, String routingKey, Message message)</span> <span class="keyword">throws</span> AmqpException;</span><br></pre></td></tr></table></figure>

<p><code>send</code>æ–¹æ³•æ˜¯å‘é€byteæ•°ç»„çš„æ•°æ®çš„æ¨¡å¼ï¼Œè¿™é‡Œä»£è¡¨æ¶ˆæ¯å†…å®¹çš„å¯¹è±¡æ˜¯<code>Message</code>å¯¹è±¡ï¼Œå®ƒçš„æ„é€ æ–¹æ³•å°±æ˜¯ä¼ å…¥byteæ•°ç»„æ•°æ®ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬çš„æ•°æ®è½¬æˆbyteæ•°ç»„ç„¶åæ„é€ æˆä¸€ä¸ª<code>Message</code>å¯¹è±¡å†è¿›è¡Œå‘é€ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Objectç±»å‹ï¼Œå¯ä»¥ä¼ å…¥POJO</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">convertAndSend</span><span class="params">(Object message)</span> <span class="keyword">throws</span> AmqpException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">convertAndSend</span><span class="params">(String routingKey, Object message)</span> <span class="keyword">throws</span> AmqpException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">convertAndSend</span><span class="params">(String exchange, String routingKey, Object message)</span> <span class="keyword">throws</span> AmqpException;</span><br></pre></td></tr></table></figure>

<p><code>convertAndSend</code>æ–¹æ³•æ˜¯å¯ä»¥ä¼ å…¥POJOå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œåº•å±‚æ˜¯æœ‰ä¸€ä¸ª<code>MessageConverter</code>å¸®æˆ‘ä»¬è‡ªåŠ¨å°†æ•°æ®è½¬æ¢æˆbyteç±»å‹æˆ–Stringæˆ–åºåˆ—åŒ–ç±»å‹ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œæ”¯æŒçš„ä¼ å…¥å¯¹è±¡ä¹Ÿåªæœ‰ä¸‰ç§ï¼šbyteç±»å‹ï¼ŒStringç±»å‹å’Œå®ç°äº†<code>Serializable</code>æ¥å£çš„POJOã€‚</p>
<p>ä»‹ç»å®Œäº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(&quot;rabbitProduce&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitProduce</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;Hello æˆ‘æ˜¯ä½œè€…å’Œè€³æœµï¼Œæ¬¢è¿å…³æ³¨æˆ‘ã€‚&quot;</span> + LocalDateTime.now().toString();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + message);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æŒ‡å®šæ¶ˆæ¯ç±»å‹</span></span><br><span class="line">        <span class="type">MessageProperties</span> <span class="variable">props</span> <span class="operator">=</span> MessagePropertiesBuilder.newInstance()</span><br><span class="line">                .setContentType(MessageProperties.CONTENT_TYPE_TEXT_PLAIN).build();</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.send(Producer.QUEUE_NAME,<span class="keyword">new</span> <span class="title class_">Message</span>(message.getBytes(StandardCharsets.UTF_8),props));</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">convertAndSend</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + user);</span><br><span class="line"></span><br><span class="line">        rabbitTemplate.convertAndSend(Producer.QUEUE_NAME,user);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œæˆ‘ç‰¹æ„å†™æ˜äº†ä¸¤ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç”¨æ¥æµ‹è¯•sendï¼Œå¦ä¸€ä¸ªç”¨æ¥æµ‹è¯•convertAndSendã€‚</p>
<p><code>send</code>æ–¹æ³•é‡Œæˆ‘ä»¬çœ‹ä¸‹æ¥å’Œä¹‹å‰çš„ä»£ç æ˜¯å‡ ä¹ä¸€æ ·çš„ï¼Œå®šä¹‰ä¸€ä¸ªæ¶ˆæ¯ï¼Œç„¶åç›´æ¥sendï¼Œä½†æ˜¯è¿™ä¸ªæ„é€ æ¶ˆæ¯çš„æ„é€ æ–¹æ³•å¯èƒ½æ¯”æˆ‘ä»¬æƒ³çš„è¦å¤šä¸€ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬åŸæ¥è¯´çš„åªè¦æŠŠæ•°æ®è½¬æˆäºŒè¿›åˆ¶æ•°ç»„æ”¾è¿›å»å³å¯ï¼Œç°åœ¨çœ‹æ¥è¿˜è¦å¤šæ”¾ä¸€ä¸ªå‚æ•°äº†ã€‚</p>
<p><code>MessageProperties</code>ï¼Œæ˜¯çš„æˆ‘ä»¬éœ€è¦å¤šæ”¾ä¸€ä¸ª<code>MessageProperties</code>å¯¹è±¡ï¼Œä»ä»–çš„åå­—æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡ºå®ƒçš„åŠŸèƒ½å°±æ˜¯é™„å¸¦ä¸€äº›å‚æ•°ï¼Œä½†æ˜¯æŸäº›å‚æ•°æ˜¯å°‘ä¸äº†çš„ï¼Œä¸å¸¦ä¸è¡Œã€‚</p>
<p>æ¯”å¦‚æˆ‘çš„ä»£ç è¿™é‡Œå°±æ˜¯è®¾ç½®äº†ä¸€ä¸‹æ¶ˆæ¯çš„ç±»å‹ï¼Œæ¶ˆæ¯çš„ç±»å‹æœ‰å¾ˆå¤šç§å¯ä»¥æ˜¯äºŒè¿›åˆ¶ç±»å‹ï¼Œæ–‡æœ¬ç±»å‹ï¼Œæˆ–è€…åºåˆ—åŒ–ç±»å‹ï¼ŒJSONç±»å‹ï¼Œæˆ‘è¿™é‡Œè®¾ç½®çš„å°±æ˜¯æ–‡æœ¬ç±»å‹ï¼ŒæŒ‡å®šç±»å‹æ˜¯å¿…é¡»çš„ï¼Œä¹Ÿå¯ä»¥ä¸ºæˆ‘ä»¬æ‹¿åˆ°æ¶ˆæ¯ä¹‹åè¦å°†æ¶ˆæ¯è½¬æ¢æˆä»€ä¹ˆæ ·çš„å¯¹è±¡æä¾›ä¸€ä¸ªå‚è€ƒã€‚</p>
<p><code>convertAndSend</code>æ–¹æ³•å°±è¦ç®€å•å¤ªå¤šï¼Œè¿™é‡Œæˆ‘æ”¾äº†ä¸€ä¸ªUserå¯¹è±¡æ‹¿æ¥æµ‹è¯•ç”¨ï¼Œç›´æ¥æŒ‡å®šé˜Ÿåˆ—ç„¶åæ”¾å…¥è¿™ä¸ªå¯¹è±¡å³å¯ã€‚</p>
<p><strong>Tips</strong>ï¼šUserå¿…é¡»å®ç°<code>Serializable</code>æ¥å£ï¼Œä¸ç„¶çš„è¯è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ä¼šæŠ›å‡º<code>IllegalArgumentException</code>å¼‚å¸¸ã€‚</p>
<p>ä»£ç å®Œæˆä¹‹åæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨äº†ï¼Œè¿™é‡Œæˆ‘å†™ä¸€ä¸ªæµ‹è¯•ç±»è¿›è¡Œè°ƒç”¨ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitProduceTest</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RabbitProduce rabbitProduce;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendSimpleMessage</span><span class="params">()</span> &#123;</span><br><span class="line">        rabbitProduce.send();</span><br><span class="line">        rabbitProduce.convertAndSend();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ•ˆæœå¦‚ä¸‹å›¾~</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/1.png"></p>
<p>åŒæ—¶åœ¨æ§åˆ¶å°ä½¿ç”¨å‘½ä»¤<code>rabbitmqctl.bat list_queues</code>æŸ¥çœ‹é˜Ÿåˆ—-<code>erduo</code>ç°åœ¨çš„æƒ…å†µï¼š</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/2.png"></p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬çš„ç”Ÿäº§è€…æµ‹è¯•å°±ç®—å®Œæˆäº†ï¼Œç°åœ¨æ¶ˆæ¯é˜Ÿåˆ—é‡Œä¸¤æ¡æ¶ˆæ¯äº†ï¼Œè€Œä¸”æ¶ˆæ¯ç±»å‹è‚¯å®šä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯æˆ‘ä»¬è®¾ç½®çš„æ–‡æœ¬ç±»å‹ï¼Œä¸€ä¸ªæ˜¯è‡ªåŠ¨è®¾ç½®çš„åºåˆ—åŒ–ç±»å‹ã€‚</p>
<h2 id="3-ğŸ“—æ¶ˆè´¹è€…ä¸RabbitListener"><a href="#3-ğŸ“—æ¶ˆè´¹è€…ä¸RabbitListener" class="headerlink" title="3. ğŸ“—æ¶ˆè´¹è€…ä¸RabbitListener"></a>3. ğŸ“—æ¶ˆè´¹è€…ä¸RabbitListener</h2><p>æ—¢ç„¶é˜Ÿåˆ—é‡Œé¢å·²ç»æœ‰æ¶ˆæ¯äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦çœ‹æˆ‘ä»¬è¯¥å¦‚ä½•é€šè¿‡æ–°çš„æ–¹å¼æ‹¿åˆ°æ¶ˆæ¯å¹¶æ¶ˆè´¹ä¸ç¡®è®¤äº†ã€‚</p>
<p>æ¶ˆè´¹è€…è¿™é‡Œæˆ‘ä»¬è¦ç”¨åˆ°<code>@RabbitListener</code>æ¥å¸®æˆ‘ä»¬æ‹¿åˆ°æŒ‡å®šé˜Ÿåˆ—æ¶ˆæ¯ï¼Œå®ƒçš„ç”¨æ³•å¾ˆç®€å•ä¹Ÿå¾ˆå¤æ‚ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¥è¯´ç®€å•çš„æ–¹å¼ï¼Œç›´æ¥æ”¾åˆ°æ–¹æ³•ä¸Šï¼ŒæŒ‡å®šç›‘å¬çš„é˜Ÿåˆ—å°±è¡Œäº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(&quot;rabbitConsumer&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = Producer.QUEUE_NAME)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + message);</span><br><span class="line">        channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å·²ç¡®è®¤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å°±ä»£è¡¨<code>onMessage</code>æ–¹æ³•ä¼šå¤„ç†erduo(Producer.QUEUE_NAMEæ˜¯å¸¸é‡å­—ç¬¦ä¸²â€erduoâ€)é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•é‡Œé¢æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œ<code>Message</code>å’Œ<code>Channel</code>ï¼Œå¦‚æœç”¨ä¸åˆ°<code>Channel</code>å¯ä»¥ä¸å†™æ­¤å‚æ•°ï¼Œä½†æ˜¯<code>Message</code>æ¶ˆæ¯ä¸€å®šæ˜¯è¦çš„ï¼Œå®ƒä»£è¡¨äº†æ¶ˆæ¯æœ¬èº«ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥æƒ³æƒ³ï¼Œæˆ‘ä»¬çš„ç¨‹åºä»<code>RabbitMQ</code>ä¹‹ä¸­æ‹‰å›ä¸€æ¡æ¡æ¶ˆæ¯ä¹‹åï¼Œè¦ä»¥æ€ä¹ˆæ ·çš„æ–¹å¼å±•ç¤ºç»™æˆ‘ä»¬å‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œå°±æ˜¯å°è£…ä¸ºä¸€ä¸ªä¸ª<code>Message</code>å¯¹è±¡ï¼Œè¿™é‡Œé¢æ”¾å…¥äº†ä¸€æ¡æ¶ˆæ¯çš„æ‰€æœ‰ä¿¡æ¯ï¼Œæ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆæ ·ä¸€ä¼šæˆ‘ä¸€runä½ å°±èƒ½çœ‹åˆ°äº†ã€‚</p>
<p>åŒæ—¶è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨<code>Channel</code>åšä¸€ä¸ªæ¶ˆæ¯ç¡®è®¤çš„æ“ä½œï¼Œè¿™é‡Œçš„DeliveryTagä»£è¡¨çš„æ˜¯è¿™ä¸ªæ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­çš„åºå·ï¼Œè¿™ä¸ªä¿¡æ¯å­˜æ”¾åœ¨<code>MessageProperties</code>ä¸­ã€‚</p>
<h2 id="4-ğŸ“–SpringBoot-å¯åŠ¨ï¼"><a href="#4-ğŸ“–SpringBoot-å¯åŠ¨ï¼" class="headerlink" title="4. ğŸ“–SpringBoot å¯åŠ¨ï¼"></a>4. ğŸ“–SpringBoot å¯åŠ¨ï¼</h2><p>ç¼–å†™å®Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ï¼ŒåŒæ—¶å·²ç»è¿è¡Œè¿‡ç”Ÿäº§è€…å¾€æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢æ”¾äº†ä¸¤æ¡ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å¯åŠ¨æ¶ˆæ¯ï¼ŒæŸ¥çœ‹æ¶ˆè´¹æƒ…å†µï¼š</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/3.png"></p>
<p>åœ¨æˆ‘çº¢è‰²æ¡†çº¿æ ‡è®°çš„åœ°æ–¹å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰äº†æ¶ˆè´¹è€…æ‰€ä»¥é¡¹ç›®å¯åŠ¨åå…ˆå’ŒRabbitMQå»ºç«‹äº†ä¸€ä¸ªè¿æ¥è¿›è¡Œç›‘å¬é˜Ÿåˆ—ã€‚</p>
<p>éšåå°±å¼€å§‹æ¶ˆè´¹æˆ‘ä»¬é˜Ÿåˆ—ä¸­çš„ä¸¤æ¡æ¶ˆæ¯ï¼š</p>
<p>ç¬¬ä¸€æ¡ä¿¡æ¯æ˜¯<code>contentType=text/plain</code>ç±»å‹ï¼Œæ‰€ä»¥ç›´æ¥å°±åœ¨æ§åˆ¶å°ä¸Šæ‰“å°å‡ºäº†å…·ä½“å†…å®¹ã€‚</p>
<p>ç¬¬äºŒæ¡ä¿¡æ¯æ˜¯<code>contentType=application/x-java-serialized-object</code>ï¼Œåœ¨æ‰“å°çš„æ—¶å€™åªæ‰“å°äº†ä¸€ä¸ªå†…å­˜åœ°å€+å­—èŠ‚å¤§å°ã€‚</p>
<p>ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ•°æ®æˆ‘ä»¬æ˜¯æ‹¿åˆ°äº†ï¼Œä¹Ÿå°±æ˜¯ä»£è¡¨æˆ‘ä»¬çš„æ¶ˆè´¹æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼ŒåŒæ—¶ä¹Ÿéƒ½è¿›è¡Œäº†æ¶ˆæ¯ç¡®è®¤æ“ä½œï¼Œä»æ•°æ®ä¸Šçœ‹ï¼Œæ•´ä¸ªæ¶ˆæ¯å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š<code>body</code>å’Œ<code>MessageProperties</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ³¨è§£æ‹¿åˆ°è¿™ä¸ªbodyçš„å†…å®¹ - <code>@Payload</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = Producer.QUEUE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> String body, Channel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Message content : &quot;</span> + body);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå¯ä»¥å•ç‹¬ä½¿ç”¨ä¸€ä¸ªæ³¨è§£æ‹¿åˆ°<code>MessageProperties</code>çš„headerså±æ€§ï¼Œheaderså±æ€§åœ¨æˆªå›¾é‡Œä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œåªä¸è¿‡æ˜¯ä¸ªç©ºçš„ - @Headersã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = Producer.QUEUE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> String body, <span class="meta">@Headers</span> Map&lt;String,Object&gt; headers)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Message content : &quot;</span> + body);</span><br><span class="line">    System.out.println(<span class="string">&quot;Message headers : &quot;</span> + headers);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸¤ä¸ªæ³¨è§£éƒ½ç®—æ˜¯æ‰©å±•çŸ¥è¯†ï¼Œæˆ‘è¿˜æ˜¯æ›´å–œæ¬¢ç›´æ¥æ‹¿åˆ°å…¨éƒ¨ï¼Œå…¨éƒ½è¦ï¼ï¼ï¼</p>
<p>ä¸Šé¢æˆ‘ä»¬å·²ç»å®Œæˆäº†æ¶ˆæ¯çš„å‘é€ä¸æ¶ˆè´¹ï¼Œæ•´ä¸ªè¿‡ç¨‹æˆ‘ä»¬å¯ä»¥å†æ¬¡å›æƒ³ä¸€ä¸‹ï¼Œä¸€åˆ‡éƒ½å’Œæˆ‘ç”»çš„è¿™å¼ å›¾ä¸Šä¸€æ ·çš„è½¨è¿¹ï¼š</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/4.png"></p>
<p>åªä¸è¿‡æˆ‘ä»¬ä¸€ç›´æ²¡æœ‰æŒ‡å®š<code>Exchage</code>ä¸€ç›´ä½¿ç”¨çš„é»˜è®¤è·¯ç”±ï¼Œå¸Œæœ›å¤§å®¶å¥½å¥½è®°ä½è¿™å¼ å›¾ã€‚</p>
<h2 id="5-ğŸ“˜-RabbitListenerä¸-RabbitHandler"><a href="#5-ğŸ“˜-RabbitListenerä¸-RabbitHandler" class="headerlink" title="5. ğŸ“˜@RabbitListenerä¸@RabbitHandler"></a>5. ğŸ“˜@RabbitListenerä¸@RabbitHandler</h2><p>ä¸‹é¢å†æ¥è¡¥ä¸€äº›çŸ¥è¯†ç‚¹ï¼Œæœ‰å…³<code>@RabbitListener</code>ä¸<code>@RabbitHandler</code>ã€‚</p>
<p><code>@RabbitListener</code>ä¸Šé¢æˆ‘ä»¬å·²ç»ç®€å•çš„è¿›è¡Œäº†ä½¿ç”¨ï¼Œç¨å¾®æ‰©å±•ä¸€ä¸‹å®ƒå…¶å®æ˜¯å¯ä»¥ç›‘å¬å¤šä¸ªé˜Ÿåˆ—çš„ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RabbitListener(queues = &#123; <span class="string">&quot;queue1&quot;</span>, <span class="string">&quot;queue2&quot;</span> &#125;)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMessage</span>(<span class="params">Message message, Channel channel</span>) throws Exception</span> &#123;</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">&quot;Message content : &quot;</span> + message);</span><br><span class="line">    channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">    System.<span class="keyword">out</span>.println(<span class="string">&quot;æ¶ˆæ¯å·²ç¡®è®¤&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿˜æœ‰ä¸€äº›å…¶ä»–çš„ç‰¹æ€§å¦‚ç»‘å®šä¹‹ç±»çš„ï¼Œè¿™é‡Œä¸å†èµ˜è¿°å› ä¸ºå¤ªç¡¬ç¼–ç äº†ä¸€èˆ¬ç”¨ä¸ä¸Šã€‚</p>
<p>ä¸‹é¢æ¥è¯´è¯´è¿™èŠ‚è¦ä¸»è¦è®²çš„ä¸€ä¸ªç‰¹æ€§ï¼š@RabbitListenerå’Œ@RabbitHandlerçš„æ­é…ä½¿ç”¨ã€‚</p>
<p>å‰é¢æˆ‘ä»¬æ²¡æœ‰æåˆ°ï¼Œ<code>@RabbitListener</code>æ³¨è§£å…¶å®æ˜¯å¯ä»¥æ³¨è§£åœ¨ç±»ä¸Šçš„ï¼Œè¿™ä¸ªæ³¨è§£åœ¨ç±»ä¸Šæ ‡å¿—ç€è¿™ä¸ªç±»ç›‘å¬æŸä¸ªé˜Ÿåˆ—æˆ–æŸäº›é˜Ÿåˆ—ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ³¨è§£çš„æ­é…ä½¿ç”¨å°±è¦è®©<code>@RabbitListener</code>æ³¨è§£åœ¨ç±»ä¸Šï¼Œç„¶åç”¨<code>@RabbitHandler</code>æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œæ ¹æ®æ–¹æ³•å‚æ•°çš„ä¸åŒè‡ªåŠ¨è¯†åˆ«å¹¶å»æ¶ˆè´¹ï¼Œå†™ä¸ªä¾‹å­ç»™å¤§å®¶çœ‹ä¸€çœ‹æ›´ç›´è§‚ä¸€äº›ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(&quot;rabbitConsumer&quot;)</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = Producer.QUEUE_NAME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitConsumer</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> String message)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(<span class="meta">@Payload</span> User user)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¤§å®¶å¯ä»¥çœ‹çœ‹è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å…ˆç”¨<code>@RabbitListener</code>ç›‘å¬<code>erduo</code>é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼Œç„¶åä½¿ç”¨<code>@RabbitHandler</code>æ³¨è§£äº†ä¸¤ä¸ªæ–¹æ³•ã€‚</p>
<ul>
<li><p>  <strong>ç¬¬ä¸€ä¸ª</strong>æ–¹æ³•çš„bodyç±»å‹æ˜¯Stringç±»å‹ï¼Œè¿™å°±ä»£è¡¨ç€è¿™ä¸ªæ–¹æ³•åªèƒ½å¤„ç†æ–‡æœ¬ç±»å‹çš„æ¶ˆæ¯ã€‚</p>
</li>
<li><p>  <strong>ç¬¬äºŒä¸ªæ–¹æ³•</strong>çš„bodyç±»å‹æ˜¯Userç±»å‹ï¼Œè¿™å°±ä»£è¡¨ç€è¿™ä¸ªæ–¹æ³•åªèƒ½å¤„ç†åºåˆ—åŒ–ç±»å‹ä¸”ä¸ºUserç±»å‹çš„æ¶ˆæ¯ã€‚</p>
</li>
</ul>
<p>è¿™ä¸¤ä¸ªæ–¹æ³•æ­£å¥½å¯¹åº”ç€æˆ‘ä»¬ç¬¬äºŒèŠ‚ä¸­æµ‹è¯•ç±»ä¼šå‘é€çš„ä¸¤ç§æ¶ˆæ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾€RabbitMQä¸­å‘é€ä¸¤æ¡æµ‹è¯•æ¶ˆæ¯ï¼Œç”¨æ¥æµ‹è¯•è¿™æ®µä»£ç ï¼Œçœ‹çœ‹æ•ˆæœï¼š</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/5.png"></p>
<p>éƒ½åœ¨æ§åˆ¶å°ä¸Šå¦‚å¸¸æ‰“å°äº†ï¼Œå¦‚æœ<code>@RabbitHandler</code>æ³¨è§£çš„æ–¹æ³•ä¸­æ²¡æœ‰ä¸€ä¸ªçš„ç±»å‹å¯ä»¥å’Œä½ æ¶ˆæ¯çš„ç±»å‹å¯¹çš„ä¸Šï¼Œæ¯”å¦‚æ¶ˆæ¯éƒ½æ˜¯byteæ•°ç»„ç±»å‹ï¼Œè¿™é‡Œæ²¡æœ‰å¯¹åº”çš„æ–¹æ³•å»æ¥æ”¶ï¼Œç³»ç»Ÿå°±ä¼šåœ¨æ§åˆ¶å°ä¸æ–­çš„æŠ¥é”™ï¼Œå¦‚æœä½ å‡ºç°è¿™ä¸ªæƒ…å†µå°±è¯æ˜ä½ ç±»å‹å†™çš„ä¸æ­£ç¡®ã€‚</p>
<p>å‡è®¾ä½ çš„<code>erduo</code>é˜Ÿåˆ—ä¸­ä¼šå‡ºç°ä¸‰ç§ç±»å‹çš„æ¶ˆæ¯ï¼šbyteï¼Œæ–‡æœ¬å’Œåºåˆ—åŒ–ï¼Œé‚£ä½ å°±å¿…é¡»è¦æœ‰å¯¹åº”çš„å¤„ç†è¿™ä¸‰ç§æ¶ˆæ¯çš„æ–¹æ³•ï¼Œä¸ç„¶æ¶ˆæ¯å‘è¿‡æ¥çš„æ—¶å€™å°±ä¼šå› ä¸ºæ— æ³•æ­£ç¡®è½¬æ¢è€ŒæŠ¥é”™ã€‚</p>
<p>è€Œä¸”ä½¿ç”¨äº†<code>@RabbitHandler</code>æ³¨è§£ä¹‹åå°±ä¸èƒ½å†å’Œä¹‹å‰ä¸€æ ·ä½¿ç”¨<code>Message</code>åšæ¥æ”¶ç±»å‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitHandler</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Message message, Channel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Message content : &quot;</span> + message);</span><br><span class="line">    channel.basicAck(message.getMessageProperties().getDeliveryTag(),<span class="literal">false</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆæ¯å·²ç¡®è®¤&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å†™çš„è¯ä¼šæŠ¥ç±»å‹è½¬æ¢å¼‚å¸¸çš„ï¼Œæ‰€ä»¥äºŒè€…é€‰å…¶ä¸€ã€‚</p>
<p>åŒæ—¶ä¸Šæ–‡æˆ‘çš„<code>@RabbitHandler</code>æ²¡æœ‰è¿›è¡Œæ¶ˆæ¯ç¡®è®¤ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¯•ä¸€ä¸‹è¿›è¡Œæ¶ˆæ¯ç¡®è®¤ã€‚</p>
<h2 id="6-ğŸ“™æ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢"><a href="#6-ğŸ“™æ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢" class="headerlink" title="6. ğŸ“™æ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢"></a>6. ğŸ“™æ¶ˆæ¯çš„åºåˆ—åŒ–è½¬æ¢</h2><p>é€šè¿‡ä¸Šæ–‡æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œèƒ½è¢«è‡ªåŠ¨è½¬æ¢çš„å¯¹è±¡åªæœ‰<code>byte[]</code>ã€<code>String</code>ã€<code>javaåºåˆ—åŒ–å¯¹è±¡</code>(å®ç°äº†Serializableæ¥å£çš„å¯¹è±¡)ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„Javaå¯¹è±¡éƒ½ä¼šå»å®ç°Serializableæ¥å£ï¼Œè€Œä¸”åºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ä½¿ç”¨çš„æ˜¯JDKè‡ªå¸¦çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æ›´æ™®éçš„åšæ³•æ˜¯ï¼šä½¿ç”¨Jacksonå…ˆå°†æ•°æ®è½¬æ¢æˆJSONæ ¼å¼å‘é€ç»™<code>RabbitMQ</code>ï¼Œå†æ¥æ”¶æ¶ˆæ¯çš„æ—¶å€™å†ç”¨Jacksonå°†æ•°æ®ååºåˆ—åŒ–å‡ºæ¥ã€‚</p>
<p>è¿™æ ·åšå¯ä»¥å®Œç¾è§£å†³ä¸Šé¢çš„ç—›ç‚¹ï¼šæ¶ˆæ¯å¯¹è±¡æ—¢ä¸å¿…å†å»å®ç°Serializableæ¥å£ï¼Œä¹Ÿæœ‰æ¯”è¾ƒé«˜çš„æ•ˆç‡(Jacksonåºåˆ—åŒ–æ•ˆç‡ä¸šç•Œåº”è¯¥æ˜¯æœ€å¥½çš„äº†)ã€‚</p>
<p>é»˜è®¤çš„æ¶ˆæ¯è½¬æ¢æ–¹æ¡ˆæ˜¯æ¶ˆæ¯è½¬æ¢é¡¶å±‚æ¥å£-<code>MessageConverter</code>çš„ä¸€ä¸ªå­ç±»ï¼š<code>SimpleMessageConverter</code>ï¼Œæˆ‘ä»¬å¦‚æœè¦æ¢åˆ°å¦ä¸€ä¸ªæ¶ˆæ¯è½¬æ¢å™¨åªéœ€è¦æ›¿æ¢æ‰è¿™ä¸ªè½¬æ¢å™¨å°±è¡Œäº†ã€‚</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/6.png"></p>
<p>ä¸Šå›¾æ˜¯<code>MessageConverter</code>ç»“æ„æ ‘çš„ç»“æ„æ ‘ï¼Œå¯ä»¥çœ‹åˆ°é™¤äº†<code>SimpleMessageConverter</code>ä¹‹å¤–è¿˜æœ‰ä¸€ä¸ª<code>Jackson2JsonMessageConverter</code>ï¼Œæˆ‘ä»¬åªéœ€è¦å°†å®ƒå®šä¹‰ä¸ºBeanï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªè½¬æ¢å™¨äº†ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> MessageConverter <span class="title function_">jackson2JsonMessageConverter</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Jackson2JsonMessageConverter</span>(jacksonObjectMapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å¯ä»¥äº†ï¼Œè¿™é‡Œçš„<code>jacksonObjectMapper</code>å¯ä»¥ä¸ä¼ å…¥ï¼Œä½†æ˜¯é»˜è®¤çš„<code>ObjectMapper</code>æ–¹æ¡ˆå¯¹JDK8çš„æ—¶é—´æ—¥æœŸåºåˆ—åŒ–ä¼šä¸å¤ªå‹å¥½ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘çš„ä¸Šä¸€ç¯‡æ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://juejin.im/post/6854573211528249357" title="https://juejin.im/post/6854573211528249357">ä»LocalDateTimeåºåˆ—åŒ–æ¢è®¨å…¨å±€ä¸€è‡´æ€§åºåˆ—åŒ–</a>ï¼Œæ€»çš„æ¥è¯´å°±æ˜¯å®šä¹‰äº†è‡ªå·±çš„<code>ObjectMapper</code>ã€‚</p>
<p>åŒæ—¶ä¸ºäº†æ¥ä¸‹æ¥æµ‹è¯•æ–¹ä¾¿ï¼Œæˆ‘åˆå®šä¹‰äº†ä¸€ä¸ªä¸“é—¨æµ‹è¯•JSONåºåˆ—åŒ–çš„é˜Ÿåˆ—ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Queue <span class="title function_">erduoJson</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// å…¶ä¸‰ä¸ªå‚æ•°ï¼šdurable exclusive autoDelete</span></span><br><span class="line">    <span class="comment">// ä¸€èˆ¬åªè®¾ç½®ä¸€ä¸‹æŒä¹…åŒ–å³å¯</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;erduo_json&quot;</span>,<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>å¦‚æ­¤ä¹‹åå°±å¯ä»¥è¿›è¡Œæµ‹è¯•äº†ï¼Œå…ˆæ˜¯<strong>ç”Ÿäº§è€…ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendObject</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Client</span> <span class="variable">client</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Client</span>();</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;Message content : &quot;</span> + client);</span><br><span class="line"></span><br><span class="line">    rabbitTemplate.convertAndSend(RabbitJsonConsumer.JSON_QUEUE,client);</span><br><span class="line">    System.out.println(<span class="string">&quot;æ¶ˆæ¯å‘é€å®Œæ¯•ã€‚&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘å®šä¹‰äº†ä¸€ä¸ª<code>Client</code>å¯¹è±¡ï¼Œå®ƒå’Œä¹‹å‰æµ‹è¯•ä½¿ç”¨çš„Userå¯¹è±¡æˆå‘˜å˜é‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„æ˜¯å®ƒæ²¡æœ‰å®ç°Serializableæ¥å£ã€‚</p>
<p>åŒæ—¶ä¸ºäº†ä¿ç•™ä¹‹å‰çš„æµ‹è¯•ä»£ç ï¼Œæˆ‘åˆæ–°å»ºäº†ä¸€ä¸ª<code>RabbitJsonConsumer</code>ï¼Œç”¨äºæµ‹è¯•JSONåºåˆ—åŒ–çš„ç›¸å…³æ¶ˆè´¹ä»£ç ï¼Œé‡Œé¢å®šä¹‰äº†ä¸€ä¸ªé™æ€å˜é‡ï¼š<code>JSON_QUEUE = &quot;erduo_json&quot;</code>;</p>
<p>æ‰€ä»¥è¿™æ®µä»£ç æ˜¯å°†<code>Client</code>å¯¹è±¡ä½œä¸ºæ¶ˆæ¯å‘é€åˆ°<code>&quot;erduo_json&quot;</code>é˜Ÿåˆ—ä¸­å»ï¼Œéšåæˆ‘ä»¬åœ¨æµ‹è¯•ç±»ä¸­runä¸€ä¸‹è¿›è¡Œä¸€æ¬¡å‘é€ã€‚</p>
<p>ç´§ç€æ˜¯<strong>æ¶ˆè´¹è€…ä»£ç </strong>ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component(&quot;rabbitJsonConsumer&quot;)</span></span><br><span class="line"><span class="meta">@RabbitListener(queues = RabbitJsonConsumer.JSON_QUEUE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RabbitJsonConsumer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">JSON_QUEUE</span> <span class="operator">=</span> <span class="string">&quot;erduo_json&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitHandler</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onMessage</span><span class="params">(Client client, <span class="meta">@Headers</span> Map&lt;String,Object&gt; headers, Channel channel)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Message content : &quot;</span> + client);</span><br><span class="line">        System.out.println(<span class="string">&quot;Message headers : &quot;</span> + headers);</span><br><span class="line">        channel.basicAck((Long) headers.get(AmqpHeaders.DELIVERY_TAG),<span class="literal">false</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ¶ˆæ¯å·²ç¡®è®¤&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æœ‰äº†ä¸Šæ–‡çš„ç»éªŒä¹‹åï¼Œè¿™æ®µä»£ç ç†è§£èµ·æ¥ä¹Ÿæ˜¯å¾ˆç®€å•äº†å§ï¼ŒåŒæ—¶ç»™å‡ºäº†ä¸Šä¸€èŠ‚æ²¡å†™çš„å¦‚ä½•åœ¨<code>@RabbitHandler</code>æ¨¡å¼ä¸‹è¿›è¡Œæ¶ˆæ¯ç­¾æ”¶ã€‚</p>
<p>æˆ‘ä»¬ç›´æ¥æ¥çœ‹çœ‹æ•ˆæœï¼š</p>
<p><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/7.png"><br><img src="/images/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%892/8.png"></p>
<p>åœ¨æ‰“å°çš„Headersé‡Œé¢ï¼Œå¾€åç¿»å¯ä»¥çœ‹åˆ°<code>contentType=application/json</code>ï¼Œè¿™ä¸ª<code>contentType</code>æ˜¯è¡¨æ˜äº†æ¶ˆæ¯çš„ç±»å‹ï¼Œè¿™é‡Œæ­£æ˜¯è¯´æ˜æˆ‘ä»¬æ–°çš„æ¶ˆæ¯è½¬æ¢å™¨ç”Ÿæ•ˆäº†ï¼Œå°†æ‰€æœ‰æ¶ˆæ¯éƒ½è½¬æ¢æˆäº†JSONç±»å‹ã€‚</p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>è¿™ä¸¤ç¯‡è®²å®Œäº†<code>RabbitMQ</code>çš„åŸºæœ¬æ”¶å‘æ¶ˆæ¯ï¼ŒåŒ…æ‹¬æ‰‹åŠ¨é…ç½®å’Œè‡ªåŠ¨é…ç½®çš„ä¸¤ç§æ–¹å¼ï¼Œè¿™äº›å¤§å®¶ä»”ç»†ç ”è¯»ä¹‹ååº”è¯¥ä¼šå¯¹<code>RabbitMQ</code>æ”¶å‘æ¶ˆæ¯æ²¡ä»€ä¹ˆç–‘é—®äº†~</p>
<p>ä¸è¿‡æˆ‘ä»¬ä¸€ç›´ä»¥æ¥å‘æ¶ˆæ¯æ—¶éƒ½æ˜¯ä½¿ç”¨é»˜è®¤çš„äº¤æ¢æœºï¼Œä¸‹ç¯‡å°†ä¼šè®²è¿°ä¸€ä¸‹<code>RabbitMQ</code>çš„å‡ ç§äº¤æ¢æœºç±»å‹ï¼Œä»¥åŠå…¶ä½¿ç”¨æ–¹å¼ã€‚</p>
<p>è®²å®Œäº†äº¤æ¢æœºä¹‹åï¼Œè¿™äº›<code>RabbitMQ</code>çš„å¸¸ç”¨æ¦‚å¿µåŸºæœ¬å°±å®Œå–„äº†ã€‚</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://moqiang02.github.io/2022/09/29/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%89%EF%BC%88%E4%BA%8C%EF%BC%89%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0SpringBoot-RabbitMQ%E6%96%B9%E5%BC%8F%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF/" data-id="cla0v65zj00wtg0v1hr2aam2r" data-title="RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆäºŒï¼‰ä¸€æ–‡å¸¦ä½ SpringBoot+RabbitMQæ–¹å¼æ”¶å‘æ¶ˆæ¯" class="article-share-link">åˆ†äº«</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" rel="tag">æ¶ˆæ¯é˜Ÿåˆ—</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2022/09/29/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%89%EF%BC%88%E4%B8%89%EF%BC%89%E4%B8%8A%E6%89%8B%E4%BA%86RabbitMQ%EF%BC%9F%E5%86%8D%E6%9D%A5%E7%9C%8B%E7%9C%8B%E5%AE%83%E7%9A%84%E4%BA%A4%E6%8D%A2%E6%9C%BA-Exchange-%E5%90%A7/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">å‰ä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆä¸‰ï¼‰ä¸Šæ‰‹äº†RabbitMQï¼Ÿå†æ¥çœ‹çœ‹å®ƒçš„äº¤æ¢æœº(Exchange)å§
        
      </div>
    </a>
  
  
    <a href="/2022/09/29/RabbitMQ%E4%BB%8E%E6%96%B0%E6%89%8B%E5%88%B0%E7%86%9F%E6%82%89%EF%BC%88%E4%B8%80%EF%BC%89%E6%B2%A1%E7%94%A8%E8%BF%87%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%EF%BC%9F%E4%B8%80%E6%96%87%E5%B8%A6%E4%BD%A0%E4%BD%93%E9%AA%8CRabbitMQ%E6%94%B6%E5%8F%91%E6%B6%88%E6%81%AF/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">åä¸€ç¯‡</strong>
      <div class="article-nav-title">RabbitMQä»æ–°æ‰‹åˆ°ç†Ÿæ‚‰ï¼ˆä¸€ï¼‰æ²¡ç”¨è¿‡æ¶ˆæ¯é˜Ÿåˆ—ï¼Ÿä¸€æ–‡å¸¦ä½ ä½“éªŒRabbitMQæ”¶å‘æ¶ˆæ¯</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">255</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/apache/">apache</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github%E5%8D%9A%E5%AE%A2/">githubåšå®¢</a><span class="category-list-count">17</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html-css/">html+css</a><span class="category-list-count">24</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iis/">iis</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">66</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">114</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">72</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">41</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">185</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83/">å…¶å®ƒ</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">å¼€å‘å·¥å…·</a><span class="category-list-count">51</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">å¼€æºé¡¹ç›®</a><span class="category-list-count">73</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/">ç”Ÿæ´»éšç¬”</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">ç½‘ç»œ</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/">é‡åŒ–äº¤æ˜“</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾äº‘</h3>
    <div class="widget tagcloud">
      <a href="/tags/AndroidStudio/" style="font-size: 13.75px;">AndroidStudio</a> <a href="/tags/AndroidUI/" style="font-size: 20px;">AndroidUI</a> <a href="/tags/Android%E4%BA%8B%E4%BB%B6%E6%8B%A6%E6%88%AA/" style="font-size: 11.25px;">Androidäº‹ä»¶æ‹¦æˆª</a> <a href="/tags/Android%E5%BC%80%E6%BA%90/" style="font-size: 18.13px;">Androidå¼€æº</a> <a href="/tags/CI/" style="font-size: 15.63px;">CI</a> <a href="/tags/CURL/" style="font-size: 13.13px;">CURL</a> <a href="/tags/DEDE/" style="font-size: 18.75px;">DEDE</a> <a href="/tags/Docker/" style="font-size: 15px;">Docker</a> <a href="/tags/Flask/" style="font-size: 10.63px;">Flask</a> <a href="/tags/JavaSE/" style="font-size: 18.13px;">JavaSE</a> <a href="/tags/Laravel/" style="font-size: 18.13px;">Laravel</a> <a href="/tags/Maven/" style="font-size: 11.25px;">Maven</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/SpringBoot/" style="font-size: 19.38px;">SpringBoot</a> <a href="/tags/Thinkphp/" style="font-size: 10px;">Thinkphp</a> <a href="/tags/UEditor/" style="font-size: 11.88px;">UEditor</a> <a href="/tags/VMware/" style="font-size: 12.5px;">VMware</a> <a href="/tags/Vue/" style="font-size: 18.13px;">Vue</a> <a href="/tags/WebSocket/" style="font-size: 13.13px;">WebSocket</a> <a href="/tags/ecshop/" style="font-size: 15px;">ecshop</a> <a href="/tags/scrapy/" style="font-size: 14.38px;">scrapy</a> <a href="/tags/smarty/" style="font-size: 12.5px;">smarty</a> <a href="/tags/socket/" style="font-size: 15px;">socket</a> <a href="/tags/sphinx/" style="font-size: 11.88px;">sphinx</a> <a href="/tags/vagrant/" style="font-size: 12.5px;">vagrant</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.25px;">å¾®æœåŠ¡</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/" style="font-size: 15.63px;">æ•°æ®ä¼ è¾“</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 11.88px;">æ­£åˆ™</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 16.25px;">æ¶ˆæ¯é˜Ÿåˆ—</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 16.88px;">çˆ¬è™«</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 17.5px;">é›†ç¾¤</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/12/06/Java-%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%9A%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82%E7%BA%BF%E7%A8%8B%E6%B1%A0/">Java å¤šçº¿ç¨‹ï¼šå½»åº•ææ‡‚çº¿ç¨‹æ± </a>
          </li>
        
          <li>
            <a href="/2022/12/04/Autowired%E6%B3%A8%E8%A7%A3%E4%B8%8EResource%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%8C%BA%E5%88%AB/">Autowiredæ³¨è§£ä¸Resourceæ³¨è§£çš„åŒºåˆ«</a>
          </li>
        
          <li>
            <a href="/2022/11/29/Maven%E5%A4%9A%E6%A8%A1%E5%9D%97%E9%A1%B9%E7%9B%AE%E5%AE%9E%E7%8E%B0%E5%85%B1%E7%94%A8%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/">Mavenå¤šæ¨¡å—é¡¹ç›®å®ç°å…±ç”¨é…ç½®æ–‡ä»¶</a>
          </li>
        
          <li>
            <a href="/2022/11/27/Java%E6%95%99%E7%A8%8B%E7%B4%A2%E5%BC%95/">Javaæ•™ç¨‹ç´¢å¼•</a>
          </li>
        
          <li>
            <a href="/2022/11/23/Spring-Boot-Event-%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%EF%BC%8C%E8%BD%BB%E6%9D%BE%E5%AE%9E%E7%8E%B0%E4%B8%9A%E5%8A%A1%E8%A7%A3%E8%80%A6/">SpringBoot Event è§‚å¯Ÿè€…æ¨¡å¼ï¼Œè½»æ¾å®ç°ä¸šåŠ¡è§£è€¦</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 moqiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>

<!-- rex -->

<script src="/js/toc.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>