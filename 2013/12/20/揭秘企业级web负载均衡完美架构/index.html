<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>揭秘企业级web负载均衡完美架构 | 自强不息</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="相信很多朋友对企业级的负载均衡高可用实例非常感兴趣，此篇文章根据成熟的线上环境而写，旨在帮助大家迅速架构一个企业级的负载均衡高可用的web环境。 此系统架构仅映射内网VIP的80及443端口于外网的Juniper防火墙下，其它端口均关闭，内网所有机器均关闭iptables及ipfw防火墙；外网DNS指向即通过Juniper映射出来的外网地址，而此映射的地址对映的其实是内网VIP地址。这里说下端口的">
<meta property="og:type" content="article">
<meta property="og:title" content="揭秘企业级web负载均衡完美架构">
<meta property="og:url" content="http://moqiang02.github.io/2013/12/20/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/index.html">
<meta property="og:site_name" content="自强不息">
<meta property="og:description" content="相信很多朋友对企业级的负载均衡高可用实例非常感兴趣，此篇文章根据成熟的线上环境而写，旨在帮助大家迅速架构一个企业级的负载均衡高可用的web环境。 此系统架构仅映射内网VIP的80及443端口于外网的Juniper防火墙下，其它端口均关闭，内网所有机器均关闭iptables及ipfw防火墙；外网DNS指向即通过Juniper映射出来的外网地址，而此映射的地址对映的其实是内网VIP地址。这里说下端口的">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://moqiang02.github.io/images/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/1.jpg">
<meta property="article:published_time" content="2013-12-20T14:51:20.000Z">
<meta property="article:modified_time" content="2022-10-26T09:28:54.141Z">
<meta property="article:author" content="moqiang">
<meta property="article:tag" content="集群">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://moqiang02.github.io/images/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/1.jpg">
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">自强不息</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://moqiang02.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-揭秘企业级web负载均衡完美架构" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2013/12/20/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/" class="article-date">
  <time class="dt-published" datetime="2013-12-20T14:51:20.000Z" itemprop="datePublished">2013-12-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/nginx/">nginx</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      揭秘企业级web负载均衡完美架构
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      

          <!-- rex -->
          
            <!-- 文章目录开始 -->
            
              <div id="toc" class="toc-article">
              <strong class="toc-title" style="cursor:pointer">目录</strong>
              <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86%EF%BC%9ANginx-Keepalived%E7%9A%84%E8%AF%B4%E6%98%8E%E5%8F%8A%E7%8E%AF%E5%A2%83%E8%AF%B4%E6%98%8E"><span class="toc-number">1.</span> <span class="toc-text">第一部分：Nginx+Keepalived的说明及环境说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86%EF%BC%9A%E5%88%86%E5%88%AB%E5%AE%89%E8%A3%85Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%99%A8%E5%8F%8A%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E8%84%9A%E6%9C%AC"><span class="toc-number">2.</span> <span class="toc-text">第二部分：分别安装Nginx负载均衡器及相关配置脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86%EF%BC%9A%E5%AE%89%E8%A3%85Keepalived%EF%BC%8C%E8%AE%A9%E5%85%B6%E5%88%86%E5%88%AB%E4%BD%9Cweb%E5%8F%8ANginx%E7%9A%84HA"><span class="toc-number">3.</span> <span class="toc-text">第三部分：安装Keepalived，让其分别作web及Nginx的HA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%83%A8%E5%88%86%EF%BC%9A%E9%92%88%E5%AF%B9Keepalived%E7%9A%84%E4%B8%8D%E8%B6%B3%EF%BC%8C%E7%94%A8Nginx-pid-sh%E6%9D%A5%E7%9B%91%E6%8E%A7nginx%E8%BF%9B%E7%A8%8B%EF%BC%8C%E5%AE%9E%E7%8E%B0%E7%9C%9F%E6%AD%A3%E6%84%8F%E4%B9%89%E4%B8%8A%E7%9A%84%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E9%AB%98%E5%8F%AF%E7%94%A8%E3%80%82"><span class="toc-number">4.</span> <span class="toc-text">第四部分：针对Keepalived的不足，用Nginx_pid.sh来监控nginx进程，实现真正意义上的负载均衡高可用。</span></a></li></ol>
              </div>
            
            <!-- 文章目录结束 -->	  
          

        <p>相信很多朋友对企业级的负载均衡高可用实例非常感兴趣，此篇文章根据成熟的线上环境而写，旨在帮助大家迅速架构一个企业级的负载均衡高可用的web环境。</p>
<p>此系统架构仅映射内网VIP的80及443端口于外网的Juniper防火墙下，其它端口均关闭，内网所有机器均关闭iptables及ipfw防火墙；外网DNS指向即通过Juniper映射出来的外网地址，而此映射的地址对映的其实是内网VIP地址。这里说下端口的问题，有的朋友可能会很疑惑，这样映射端口行不？通过项目实践得知，这样完全是可行的，php-cgi需要的9000端口及MySQL的3306端口均可走内网，完全不影响业务系统的运行。<span id="more"></span></p>
<p>另外，我维护的电子商务网站并发大约在1000左右，此时,Nginx+Apache集群运行得非常稳定，尤其是apache，并没有想象中那般弱；其实，在内存足够(&gt;=8G)的情况，测试时不连数据库的话，单台apache+php5能顶得住6000并发，而且相当稳定。在网站升级架构方面，我不赞成全面淘汰生级，锦上添花式的升级会更好。<br><img src="/images/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/1.jpg"></p>
<h3 id="第一部分：Nginx-Keepalived的说明及环境说明"><a href="#第一部分：Nginx-Keepalived的说明及环境说明" class="headerlink" title="第一部分：Nginx+Keepalived的说明及环境说明"></a>第一部分：Nginx+Keepalived的说明及环境说明</h3><p>喜欢看我博客或文章的朋友都知道，我一直主力推崇Nginx+Keepalived作web的负载均衡高可用架构，并积极将其用于项目方案中；Nginx负载均衡作服务器遇到的故障一般有:<br>①服务器网线松动等网络故障；<br>②服务器硬件故障从而crash；<br>③nginx服务死掉；<br>遇到前二者情况，keeaplived是能起到HA的作用的；然而遇到③种情况就没有办法了，但可以通过shell监控解决这问题，从而实现真正意义上的负载均衡高可用。此篇的最新更新时间为2010年6月25号，下面将其安装步骤详细说明下：</p>
<p>环境：<br>centos5.3(64位)、nginx-0.7.51、keepalived-1.1.15<br>主nginx负载均衡器：192.168.0.154<br>辅nginx负载均衡器：192.168.9.155<br>vip：192.168.0.188 </p>
<h3 id="第二部分：分别安装Nginx负载均衡器及相关配置脚本"><a href="#第二部分：分别安装Nginx负载均衡器及相关配置脚本" class="headerlink" title="第二部分：分别安装Nginx负载均衡器及相关配置脚本"></a>第二部分：分别安装Nginx负载均衡器及相关配置脚本</h3><p>先安装Nginx负载均衡器，nginx负载的配置就用一般的模板来配置了</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加运行nginx的用户和组www  </span></span><br><span class="line">groupadd www   </span><br><span class="line">useradd -g www www   </span><br><span class="line">wget ftp:<span class="regexp">//</span>ftp.csx.cam.ac.uk<span class="regexp">/pub/</span>software<span class="regexp">/programming/</span>pcre/pcre-<span class="number">7.8</span>.tar.gz  </span><br><span class="line">tar zxvf pcre-<span class="number">7.8</span>.tar.gz  </span><br><span class="line">cd pcre-<span class="number">7.8</span>/  </span><br><span class="line">./configure  </span><br><span class="line">make &amp;&amp; make install  </span><br><span class="line">wget http:<span class="regexp">//</span>sysoev.ru<span class="regexp">/nginx/</span>nginx-<span class="number">0.7</span>.<span class="number">51</span>.tar.gz  </span><br><span class="line">tar zxvf nginx-<span class="number">0.7</span>.<span class="number">51</span>.tar.gz  </span><br><span class="line">cd nginx-<span class="number">0.7</span>.<span class="number">51</span>/  </span><br><span class="line">.<span class="regexp">/configure --user=www --group=www --prefix=/u</span>sr<span class="regexp">/local/</span>webserver/nginx --with-http_stub_status_module --with-http_ssl_module  </span><br><span class="line">make &amp;&amp; make install </span><br></pre></td></tr></table></figure>
<p>配置nginx负载均衡器的配置文件<code>vim /usr/local/nginx/conf/nginx.conf</code>,此篇文章仅仅只是我的某项目的配置文档，纯80转发；如果对nginx配置有https要求的可参考张宴的相关文章。</p>
<figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">user</span> www www<span class="comment">;  </span></span><br><span class="line">worker_processes <span class="number">8</span><span class="comment">;  </span></span><br><span class="line"> </span><br><span class="line">pid /usr/local/nginx/logs/nginx.pid<span class="comment">;  </span></span><br><span class="line">worker_rlimit_nofile <span class="number">65535</span><span class="comment">;  </span></span><br><span class="line"> </span><br><span class="line">events  </span><br><span class="line">&#123;  </span><br><span class="line">    use epoll<span class="comment">;  </span></span><br><span class="line">    worker_connections <span class="number">65535</span><span class="comment">;  </span></span><br><span class="line">&#125;  </span><br><span class="line">http&#123;  </span><br><span class="line">    include       mime.types<span class="comment">;  </span></span><br><span class="line">    default_type application/octet-stream<span class="comment">;  </span></span><br><span class="line">    server_names_hash_bucket_size <span class="number">128</span><span class="comment">;  </span></span><br><span class="line">    client_header_buffer_size <span class="number">32</span>k<span class="comment">;  </span></span><br><span class="line">    large_client_header_buffers <span class="number">4</span> <span class="number">32</span>k<span class="comment">;  </span></span><br><span class="line">    client_max_body_size <span class="number">8</span>m<span class="comment">;  </span></span><br><span class="line">    sendfile <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">    tcp_nopush     <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">    keepalive_timeout <span class="number">60</span><span class="comment">;  </span></span><br><span class="line">    tcp_nodelay <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">    fastcgi_connect_timeout <span class="number">300</span><span class="comment">;  </span></span><br><span class="line">    fastcgi_send_timeout <span class="number">300</span><span class="comment">;  </span></span><br><span class="line">    fastcgi_read_timeout <span class="number">300</span><span class="comment">;  </span></span><br><span class="line">    fastcgi_buffer_size <span class="number">64</span>k<span class="comment">;  </span></span><br><span class="line">    fastcgi_buffers <span class="number">4</span> <span class="number">64</span>k<span class="comment">;  </span></span><br><span class="line">    fastcgi_busy_buffers_size <span class="number">128</span>k<span class="comment">;  </span></span><br><span class="line">    fastcgi_temp_file_write_size <span class="number">128</span>k<span class="comment">;  </span></span><br><span class="line">    gzip <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">    gzip_min_length <span class="number">1</span>k<span class="comment">;  </span></span><br><span class="line">    gzip_buffers     <span class="number">4</span> <span class="number">16</span>k<span class="comment">;  </span></span><br><span class="line">    gzip_http_version <span class="number">1.0</span><span class="comment">;  </span></span><br><span class="line">    gzip_comp_level <span class="number">2</span><span class="comment">;  </span></span><br><span class="line">    gzip_types       text/plain application/x-javascript text/css application/xml<span class="comment">;  </span></span><br><span class="line">    gzip_vary <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">     </span><br><span class="line">    upstream backend  </span><br><span class="line">    &#123;  </span><br><span class="line">        server <span class="number">192.168</span>.<span class="number">1.102</span>:<span class="number">80</span><span class="comment">;  </span></span><br><span class="line">        server <span class="number">192.168</span>.<span class="number">1.103</span>:<span class="number">80</span><span class="comment">;  </span></span><br><span class="line">        server <span class="number">192.168</span>.<span class="number">1.105</span>:<span class="number">80</span><span class="comment">;  </span></span><br><span class="line">    &#125;  </span><br><span class="line">    server &#123;  </span><br><span class="line">        listen <span class="number">80</span><span class="comment">;  </span></span><br><span class="line">        server_name www.yuhongchun027.com<span class="comment">;  </span></span><br><span class="line">        location / &#123;  </span><br><span class="line">            root /<span class="keyword">var</span>/www <span class="comment">;  </span></span><br><span class="line">            index index.jsp index.htm index.html<span class="comment">;  </span></span><br><span class="line">            proxy_redirect <span class="literal">off</span><span class="comment">;  </span></span><br><span class="line">            proxy_set_header Host <span class="variable">$host</span><span class="comment">;  </span></span><br><span class="line">            proxy_set_header X-Real-IP <span class="variable">$remote_addr</span><span class="comment">;  </span></span><br><span class="line">            proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span><span class="comment">;  </span></span><br><span class="line">            proxy_pass http://backend<span class="comment">;  </span></span><br><span class="line">        &#125;  </span><br><span class="line">         </span><br><span class="line">        location /nginx &#123;  </span><br><span class="line">            access_log <span class="literal">on</span><span class="comment">;  </span></span><br><span class="line">            auth_basic <span class="string">&quot;NginxStatus&quot;</span><span class="comment">;  </span></span><br><span class="line">            auth_basic_user_file /usr/local/nginx/htpasswd<span class="comment">;  </span></span><br><span class="line">        &#125;  </span><br><span class="line">         </span><br><span class="line">        log_format access <span class="string">&#x27;<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] &quot;<span class="variable">$request</span>&quot; &#x27;</span>  </span><br><span class="line">        <span class="string">&#x27;<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> &quot;<span class="variable">$http_referer</span>&quot; &#x27;</span>  </span><br><span class="line">        <span class="string">&#x27;&quot;<span class="variable">$http_user_agent</span>&quot; <span class="variable">$http_x_forwarded_for</span>&#x27;</span><span class="comment">;  </span></span><br><span class="line">        access_log /<span class="keyword">var</span>/log/access.log access<span class="comment">;  </span></span><br><span class="line">         </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<p>小节：</p>
<p>第一部分和第二部分讲的是如何通过安装Nginx来达到负载均衡后端web集群的过程，Nginx能实现自动切换后端有故障的web服务器；但Nginx负载均衡器出了问题怎么办呢，它们之间是如何实现无故障转移的呢？</p>
<h3 id="第三部分：安装Keepalived，让其分别作web及Nginx的HA"><a href="#第三部分：安装Keepalived，让其分别作web及Nginx的HA" class="headerlink" title="第三部分：安装Keepalived，让其分别作web及Nginx的HA"></a>第三部分：安装Keepalived，让其分别作web及Nginx的HA</h3><p>安装keepalived，并将其做成服务模式，方便以后调试。</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="comment">//www.keepalived.org/software/keepalived-1.1.15.tar.gz  </span></span><br><span class="line">#tar zxvf keepalived-<span class="number">1.1</span>.<span class="number">15</span>.tar.gz  </span><br><span class="line">#cd keepalived-<span class="number">1.1</span>.<span class="number">15</span>  </span><br><span class="line">#.<span class="regexp">/configure --prefix=/u</span>sr<span class="regexp">/local/</span>keepalived  </span><br><span class="line">#make   </span><br><span class="line">#make install  </span><br><span class="line">#cp <span class="regexp">/usr/</span>local<span class="regexp">/keepalived/</span>sbin<span class="regexp">/keepalived /u</span>sr<span class="regexp">/sbin/</span>  </span><br><span class="line">#cp <span class="regexp">/usr/</span>local<span class="regexp">/keepalived/</span>etc<span class="regexp">/sysconfig/</span>keepalived <span class="regexp">/etc/</span>sysconfig/  </span><br><span class="line">#cp <span class="regexp">/usr/</span>local<span class="regexp">/keepalived/</span>etc<span class="regexp">/rc.d/i</span>nit.d<span class="regexp">/keepalived /</span>etc<span class="regexp">/init.d/</span>  </span><br><span class="line">#mkdir <span class="regexp">/etc/</span>keepalived  </span><br><span class="line">#cd <span class="regexp">/etc/</span>keepalived/  </span><br><span class="line"> </span><br><span class="line">vim keepalived.conf  </span><br><span class="line">! Configuration <span class="keyword">File</span> <span class="keyword">for</span> keepalived  </span><br><span class="line">global_defs &#123;  </span><br><span class="line">   notification_email &#123;  </span><br><span class="line">       yuhongchun027@<span class="number">163</span>.com  </span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from keepalived@chtopnet.com  </span><br><span class="line">   smtp_server <span class="number">127.0</span>.<span class="number">0.1</span>  </span><br><span class="line">   smtp_connect_timeout <span class="number">30</span>  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;  </span><br><span class="line">vrrp_instance VI_1 &#123;  </span><br><span class="line">    state MASTER  </span><br><span class="line">    <span class="keyword">interface</span> eth0  </span><br><span class="line">    virtual_router_id <span class="number">51</span>  </span><br><span class="line">    mcast_src_ip <span class="number">192.168</span>.<span class="number">0.154</span>    &lt;==主nginx的IP地址  </span><br><span class="line">    priority <span class="number">100</span>  </span><br><span class="line">    advert_int <span class="number">1</span>  </span><br><span class="line">    authentication &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass chtopnet  </span><br><span class="line">    &#125;  </span><br><span class="line">    virtual_ipaddress &#123;  </span><br><span class="line">        <span class="number">192.168</span>.<span class="number">0.188</span>              &lt;==vip地址  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line">#service keepalived start </span><br></pre></td></tr></table></figure>
<p>我们来看一下日志：</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@ltos ~]# tail /var/<span class="keyword">log</span>/messages  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">03</span> ltos avahi-daemon[<span class="number">2306</span>]: Registering <span class="built_in">new</span> address <span class="type">record</span> <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.188</span> <span class="keyword">on</span> eth0.  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">03</span> ltos avahi-daemon[<span class="number">2306</span>]: Registering <span class="built_in">new</span> address <span class="type">record</span> <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.154</span> <span class="keyword">on</span> eth0.  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">03</span> ltos avahi-daemon[<span class="number">2306</span>]: Registering HINFO <span class="type">record</span> <span class="keyword">with</span> <span class="keyword">values</span> <span class="string">&#x27;I686&#x27;</span>/<span class="string">&#x27;LINUX&#x27;</span>.  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">23</span> ltos avahi-daemon[<span class="number">2306</span>]: Withdrawing address <span class="type">record</span> <span class="keyword">for</span> fe80::<span class="number">20</span>c:<span class="number">29</span>ff:feb9:eeab <span class="keyword">on</span> eth0.  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">23</span> ltos avahi-daemon[<span class="number">2306</span>]: Withdrawing address <span class="type">record</span> <span class="keyword">for</span> <span class="number">192.168</span><span class="number">.0</span><span class="number">.154</span> <span class="keyword">on</span> eth0.  </span><br><span class="line">Oct <span class="number">6</span> <span class="number">03</span>:<span class="number">25</span>:<span class="number">23</span> ltos avahi-daemon[<span class="number">2306</span>]: Host <span class="type">name</span> <span class="keyword">conflict</span>, retrying <span class="keyword">with</span> &lt;ltos<span class="number">-31</span>&gt; </span><br></pre></td></tr></table></figure>
<p>很显然vrrp已经启动，我们还可以通过命令来检查</p>
<figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@ltos html]<span class="comment"># ip addr  </span></span><br><span class="line"><span class="number">1</span>: lo: <span class="variable">&lt;LOOPBACK,UP,LOWER_UP&gt;</span> mtu <span class="number">16436</span> qdisc noqueue   </span><br><span class="line">    link/loopback <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> brd <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span>  </span><br><span class="line">    <span class="keyword">inet</span> <span class="number">127.0</span>.<span class="number">0.1</span>/<span class="number">8</span> scope host lo  </span><br><span class="line">    <span class="keyword">inet6</span> ::<span class="number">1</span>/<span class="number">128</span> scope host   </span><br><span class="line">       valid_lft forever preferred_lft forever  </span><br><span class="line"><span class="number">2</span>: eth0: <span class="variable">&lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt;</span> mtu <span class="number">1500</span> qdisc pfifo_fast qlen <span class="number">1000</span>  </span><br><span class="line">    link/ether <span class="number">00</span>:<span class="number">0</span>c:<span class="number">29</span>:ba:<span class="number">9</span>b:e7 brd ff:ff:ff:ff:ff:ff  </span><br><span class="line">    <span class="keyword">inet</span> <span class="number">192.168</span>.<span class="number">0.154</span>/<span class="number">24</span> brd <span class="number">192.168</span>.<span class="number">0.255</span> scope <span class="keyword">global</span> eth0  </span><br><span class="line">    <span class="keyword">inet</span> <span class="number">192.168</span>.<span class="number">0.188</span>/<span class="number">32</span> scope <span class="keyword">global</span> eth0  </span><br><span class="line">    <span class="keyword">inet6</span> fe80::<span class="number">20</span>c:<span class="number">29</span>ff:feba:<span class="number">9</span>be7/<span class="number">64</span> scope link   </span><br><span class="line">       valid_lft forever preferred_lft forever  </span><br><span class="line"><span class="number">3</span>: sit0: <span class="variable">&lt;NOARP&gt;</span> mtu <span class="number">1480</span> qdisc noop   </span><br><span class="line">    link/sit <span class="number">0.0</span>.<span class="number">0.0</span> brd <span class="number">0.0</span>.<span class="number">0.0</span> </span><br></pre></td></tr></table></figure>
<p>说明vip已经启动，这样主服务器就配置好了，辅机的配置大致一样，除了配置文件有少部分的变化，下面贴出辅机的配置文件：</p>
<figure class="highlight fsharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">!</span> Configuration File <span class="keyword">for</span> keepalived  </span><br><span class="line"><span class="keyword">global_defs</span> &#123;  </span><br><span class="line">   <span class="keyword">notification_email</span> &#123;  </span><br><span class="line">       yuhongchun027<span class="operator">@</span><span class="number">163.</span>com  </span><br><span class="line">   &#125;  </span><br><span class="line">   notification_email_from keepalived<span class="operator">@</span>chtopnet.com  </span><br><span class="line">   smtp_server <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  </span><br><span class="line">   smtp_connect_timeout <span class="number">30</span>  </span><br><span class="line">   router_id LVS_DEVEL  </span><br><span class="line">&#125;  </span><br><span class="line">vrrp_instance VI_1 &#123;  </span><br><span class="line">    state BACKUP  </span><br><span class="line">    <span class="keyword">interface</span> eth0  </span><br><span class="line">    virtual_router_id <span class="number">51</span>  </span><br><span class="line">    mcast_src_ip <span class="number">192.168</span><span class="number">.0</span><span class="number">.155</span>              <span class="operator">&lt;==</span>辅nginx的IP的地址  </span><br><span class="line">    priority <span class="number">100</span>  </span><br><span class="line">    advert_int <span class="number">1</span>  </span><br><span class="line">    <span class="keyword">authentication</span> &#123;  </span><br><span class="line">        auth_type PASS  </span><br><span class="line">        auth_pass chtopnet  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">virtual_ipaddress</span> &#123;  </span><br><span class="line">        <span class="number">192.168</span><span class="number">.0</span><span class="number">.188</span>  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
<h3 id="第四部分：针对Keepalived的不足，用Nginx-pid-sh来监控nginx进程，实现真正意义上的负载均衡高可用。"><a href="#第四部分：针对Keepalived的不足，用Nginx-pid-sh来监控nginx进程，实现真正意义上的负载均衡高可用。" class="headerlink" title="第四部分：针对Keepalived的不足，用Nginx_pid.sh来监控nginx进程，实现真正意义上的负载均衡高可用。"></a>第四部分：针对Keepalived的不足，用Nginx_pid.sh来监控nginx进程，实现真正意义上的负载均衡高可用。</h3><p>针对Nginx+Keepalived，编写nginx监控脚本nginx_pid.sh，此脚本思路其实也很简单，即放置在后台一直监控nginx进程；如进程消失，尝试重启nginx，如是失败则立即停掉本机的keepalived服务，让另一台负载均衡器接手，此脚本直接从生产环境下载：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /root/nginx_pid.sh   </span><br><span class="line"><span class="comment">#!/bin/bash  </span></span><br><span class="line"><span class="keyword">while</span>  :  </span><br><span class="line"><span class="keyword">do</span>  </span><br><span class="line"> nginxpid=`ps -C nginx --no-header | <span class="built_in">wc</span> -l`  </span><br><span class="line"> <span class="keyword">if</span> [ <span class="variable">$nginxpid</span> -eq 0 ];<span class="keyword">then</span>  </span><br><span class="line">  /usr/local/nginx/sbin/nginx  </span><br><span class="line">  <span class="built_in">sleep</span> 5  </span><br><span class="line">nginxpid=`ps -C nginx --no-header | <span class="built_in">wc</span> -l`</span><br><span class="line">   <span class="keyword">if</span> [ <span class="variable">$nginxpid</span> -eq 0 ];<span class="keyword">then</span>  </span><br><span class="line">   /etc/init.d/keepalived stop  </span><br><span class="line">   <span class="keyword">fi</span>  </span><br><span class="line"> <span class="keyword">fi</span>  </span><br><span class="line"> <span class="built_in">sleep</span> 5   </span><br><span class="line"><span class="keyword">done</span> </span><br></pre></td></tr></table></figure>
<p>然后置于后台运行<code>sh /root/nginx_pid.sh &amp;</code>，这种写法是错误的，这样你用root用户logout后，此进程会消失；正确写法为<code>nohup/bin/bash /root/nginx_pid.sh &amp;</code>,附带下注释:如果你正在运行一个进程，而且你觉得在退出帐户时该进程还不会结束，那么可以使用nohup命令。该命令可以在你退出root帐户之后继续运行相应的进程。nohup就是不挂起的意思(no hang up)，哈哈，差点老马失蹄了。</p>
<p>后记：</p>
<p>我的线上环境网络非常复杂，这也是LVS+Keepalived失败的原因。目前此套架构在1000并发的电子商务网站非常稳定，带来的直接影响就是nginx_backup一直处于闲置状态。相对于张宴的双机轮询而言，我感觉他的可能更加完美，因为目前我的Nginx仅仅只做了负载均衡器，如果以后有机会我会尝试做负载均衡器/反向代理加速。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://moqiang02.github.io/2013/12/20/%E6%8F%AD%E7%A7%98%E4%BC%81%E4%B8%9A%E7%BA%A7web%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E5%AE%8C%E7%BE%8E%E6%9E%B6%E6%9E%84/" data-id="cla0v66fc0212g0v17p1aceks" data-title="揭秘企业级web负载均衡完美架构" class="article-share-link">分享</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%9B%86%E7%BE%A4/" rel="tag">集群</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2013/12/20/Nginx%E4%B8%BB%E4%B8%BB%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E6%9E%B6%E6%9E%84/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前一篇</strong>
      <div class="article-nav-title">
        
          Nginx主主负载均衡架构
        
      </div>
    </a>
  
  
    <a href="/2013/12/20/Nginx%E6%94%AF%E6%8C%81PHP%E7%9A%84CI%E6%A1%86%E6%9E%B6/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">后一篇</strong>
      <div class="article-nav-title">Nginx支持PHP的CI框架</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/android/">android</a><span class="category-list-count">255</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/apache/">apache</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/flutter/">flutter</a><span class="category-list-count">12</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">git</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/github%E5%8D%9A%E5%AE%A2/">github博客</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/go/">go</a><span class="category-list-count">26</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/html-css/">html+css</a><span class="category-list-count">27</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/iis/">iis</a><span class="category-list-count">15</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a><span class="category-list-count">84</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a><span class="category-list-count">124</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/kotlin/">kotlin</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">68</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/memcached/">memcached</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a><span class="category-list-count">19</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mysql/">mysql</a><span class="category-list-count">74</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nodejs/">nodejs</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/php/">php</a><span class="category-list-count">185</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">44</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/redis/">redis</a><span class="category-list-count">14</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E5%AE%83/">其它</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span class="category-list-count">52</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE/">开源项目</a><span class="category-list-count">73</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%94%9F%E6%B4%BB%E9%9A%8F%E7%AC%94/">生活随笔</a><span class="category-list-count">11</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%BD%91%E7%BB%9C/">网络</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%87%8F%E5%8C%96%E4%BA%A4%E6%98%93/">量化交易</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/AndroidStudio/" style="font-size: 13.16px;">AndroidStudio</a> <a href="/tags/AndroidUI/" style="font-size: 20px;">AndroidUI</a> <a href="/tags/Android%E4%BA%8B%E4%BB%B6%E6%8B%A6%E6%88%AA/" style="font-size: 11.05px;">Android事件拦截</a> <a href="/tags/Android%E5%BC%80%E6%BA%90/" style="font-size: 16.84px;">Android开源</a> <a href="/tags/CI/" style="font-size: 15.26px;">CI</a> <a href="/tags/CURL/" style="font-size: 12.63px;">CURL</a> <a href="/tags/DEDE/" style="font-size: 17.37px;">DEDE</a> <a href="/tags/Docker/" style="font-size: 14.21px;">Docker</a> <a href="/tags/Flask/" style="font-size: 10.53px;">Flask</a> <a href="/tags/JavaSE/" style="font-size: 18.42px;">JavaSE</a> <a href="/tags/Laravel/" style="font-size: 16.84px;">Laravel</a> <a href="/tags/Maven/" style="font-size: 11.58px;">Maven</a> <a href="/tags/MybatisPlus/" style="font-size: 11.05px;">MybatisPlus</a> <a href="/tags/Puppeteer/" style="font-size: 14.74px;">Puppeteer</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/Selenium/" style="font-size: 11.58px;">Selenium</a> <a href="/tags/SpringBoot/" style="font-size: 19.47px;">SpringBoot</a> <a href="/tags/Thinkphp/" style="font-size: 10px;">Thinkphp</a> <a href="/tags/UEditor/" style="font-size: 11.58px;">UEditor</a> <a href="/tags/VMware/" style="font-size: 12.11px;">VMware</a> <a href="/tags/Vue/" style="font-size: 18.95px;">Vue</a> <a href="/tags/WebSocket/" style="font-size: 12.63px;">WebSocket</a> <a href="/tags/ecshop/" style="font-size: 14.21px;">ecshop</a> <a href="/tags/scrapy/" style="font-size: 13.68px;">scrapy</a> <a href="/tags/smarty/" style="font-size: 12.11px;">smarty</a> <a href="/tags/socket/" style="font-size: 14.21px;">socket</a> <a href="/tags/sphinx/" style="font-size: 11.58px;">sphinx</a> <a href="/tags/vagrant/" style="font-size: 12.11px;">vagrant</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 11.05px;">微服务</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93/" style="font-size: 15.26px;">数据传输</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 11.58px;">正则</a> <a href="/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/" style="font-size: 15.79px;">消息队列</a> <a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 17.89px;">爬虫</a> <a href="/tags/%E9%9B%86%E7%BE%A4/" style="font-size: 16.32px;">集群</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2025/08/27/%E5%88%A9%E7%94%A8Jenkins%E4%B8%8EDocker%E5%AE%9E%E7%8E%B0Spring-Boot%E9%A1%B9%E7%9B%AE%E7%9A%84%E8%87%AA%E5%8A%A8%E5%8C%96%E9%83%A8%E7%BD%B2%E4%B9%8B%E9%81%93/">利用Jenkins与Docker实现Spring Boot项目的自动化部署之道</a>
          </li>
        
          <li>
            <a href="/2025/08/27/Nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1%E4%B8%AD%E5%90%8E%E7%AB%AF%E8%8A%82%E7%82%B9%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%81%A5%E5%BA%B7%E6%A3%80%E6%9F%A5/">Nginx负载均衡中后端节点服务器健康检查</a>
          </li>
        
          <li>
            <a href="/2025/06/19/%E5%BD%BB%E5%BA%95%E6%90%9E%E6%87%82Vue%E4%B8%AD%E7%9A%84Mixin%E6%B7%B7%E5%85%A5/">彻底搞懂Vue中的Mixin混入</a>
          </li>
        
          <li>
            <a href="/2025/03/14/%E5%A6%82%E4%BD%95%E5%8F%91%E5%B8%83jar%E5%8C%85%E5%88%B0maven%E4%B8%AD%E5%A4%AE%E4%BB%93%E5%BA%93/">如何发布jar包到maven中央仓库</a>
          </li>
        
          <li>
            <a href="/2025/03/14/%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8-Redis-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E5%BB%B6%E6%97%B6%E9%98%9F%E5%88%97%EF%BC%9F/">怎么使用Redis实现一个延时队列？</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 moqiang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>

<!-- rex -->

<script src="/js/toc.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>